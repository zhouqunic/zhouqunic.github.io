<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="Joking的Linux世界" type="application/atom+xml">






<meta name="description" content="个人Linux学习和工作记录的小地方">
<meta name="keywords" content="linux">
<meta property="og:type" content="website">
<meta property="og:title" content="Joking的Linux世界">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Joking的Linux世界">
<meta property="og:description" content="个人Linux学习和工作记录的小地方">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Joking的Linux世界">
<meta name="twitter:description" content="个人Linux学习和工作记录的小地方">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/">





  <title>Joking的Linux世界</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Joking的Linux世界</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">念念不忘，必有回响</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/18.6-18.10 负载均衡集群介绍、LVS和LVS NAT搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/18.6-18.10 负载均衡集群介绍、LVS和LVS NAT搭建/" itemprop="url">18.6-18.10 负载均衡集群介绍、LVS和LVS NAT搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="18-6-负载均衡集群介绍"><a href="#18-6-负载均衡集群介绍" class="headerlink" title="18.6 负载均衡集群介绍"></a>18.6 负载均衡集群介绍</h2><ul>
<li><p>主流开源软件LVS、keepalived、haproxy、nginx等 </p>
</li>
<li><p>其中LVS属于4层（网络OSI 7层模型），nginx属于7层，haproxy既可以认为是4层，也可以当做7层使用</p>
</li>
<li><p>keepalived的负载均衡功能其实就是lvs </p>
</li>
<li><p>lvs这种4层的负载均衡是可以分发除80外的其他端口通信的，比如MySQL的，而nginx仅仅支持http，https，mail，haproxy也支持MySQL这种</p>
</li>
<li><p>相比较来说，LVS这种4层的更稳定，能承受更多的请求，而nginx这种7层的更加灵活，能实现更多的个性化需求 。</p>
</li>
</ul>
<p>这里写图片描述</p>
<h2 id="18-7-LVS介绍"><a href="#18-7-LVS介绍" class="headerlink" title="18.7 LVS介绍"></a>18.7 LVS介绍</h2><ul>
<li><p>LVS是由国人章文嵩开发  </p>
</li>
<li><p>流行度不亚于apache的httpd，基于TCP/IP做的路由和转发，稳定性和效率很高  </p>
</li>
<li><p>LVS最新版本基于Linux内核2.6，有好多年不更新了  </p>
</li>
<li><p>LVS有三种常见的模式：NAT、DR、IP Tunnel  </p>
</li>
<li><p>LVS架构中有一个核心角色叫做分发器（Load balance），它用来分发用户的请求，还有诸多处理用户请求的服务器（Real Server，简称rs） </p>
</li>
<li><p>在调度器的实现技术中，IP负载均衡技术是效率最高的。</p>
</li>
<li><p>在已有的IP负载均衡技术中有通过网络地址转换（Network Address Translation）将一组服务器构成一个高性能的、高可用的虚拟服务器，我们称之为VS/NAT技术（Virtual Server via Network Address Translation），大多数商品化的IP负载均衡调度器产品都是使用此方法，如Cisco的LocalDirector、F5的Big/IP和 Alteon的ACEDirector。</p>
</li>
<li><p>在分析VS/NAT的缺点和网络服务的非对称性的基础上，我们提出通过IP隧道实现虚拟服务器的方法VS/TUN （Virtual Server via IP Tunneling），和通过直接路由实现虚拟服务器的方法VS/DR（Virtual Server via Direct Routing），它们可以极大地提高系统的伸缩性。</p>
</li>
<li><p>所以，IPVS软件实现了这三种IP负载均衡技术，它们的大致原理如下（我们将在其他章节对其工作原 理进行详细描述）：</p>
</li>
</ul>
<p><strong>LVS有三种常见的模式：NAT、DR、IP Tunnel，其实企业中最常用的是 DR 实现方式，而 NAT 配置上比较简单和方便，后边实践中会总结 DR 和 NAT 具体使用配置过程。</strong></p>
<h3 id="LVS-NAT模式"><a href="#LVS-NAT模式" class="headerlink" title="LVS NAT模式"></a>LVS NAT模式</h3><p>工作原理：Virtual Server via Network Address Translation(VS/NAT)  网络地址转换<br><strong>调度器将请求的目标 ip 即 vip 地址改为 Real server 的 ip, 返回的数据包也经过调度器，调度器再把源地址修改为 vip</strong></p>
<ul>
<li>这种模式借助iptables的nat表来实现  </li>
<li>用户的请求到分发器后，通过预设的iptables规则，把请求的数据包转发到后端的rs上去  </li>
<li>rs需要设定网关为分发器的内网ip  </li>
<li>用户请求的数据包和返回给用户的数据包全部经过分发器，所以分发器成为瓶颈  </li>
<li>在nat模式中，只需要分发器有公网ip即可，所以比较节省公网ip资源 </li>
</ul>
<p>NAT模式优缺点：</p>
<ol>
<li>NAT技术将请求的报文和响应的报文都需要通过LB进行地址改写，因此网站访问量比较大的时候LB负载均衡调度器有比较大的瓶颈，一般要求最多之能10-20台节点</li>
<li>只需要在LB上配置一个公网IP地址就可以了。</li>
<li>每台内部的节点服务器的网关地址必须是调度器LB的内网地址。</li>
<li>NAT模式支持对IP地址和端口进行转换。即用户请求的端口和真实服务器的端口可以不一致。</li>
</ol>
<h3 id="LVS-IP-Tunnel模式"><a href="#LVS-IP-Tunnel模式" class="headerlink" title="LVS IP Tunnel模式"></a>LVS IP Tunnel模式</h3><p>工作原理：Virtual Server via IP Tunneling IP隧道封装<br><strong>调度器将请求来的数据包封装加密通过 ip 隧道转发到后端的 real server 上，而 real server 会直接把数据返回给客户端，而不再经过调度器</strong></p>
<ul>
<li>这种模式，需要有一个公共的IP配置在分发器和所有rs上，我们把它叫做vip  </li>
<li>客户端请求的目标IP为vip，分发器接收到请求数据包后，会对数据包做一个加工，会把目标IP改为rs的IP，这样数据包就到了rs上  </li>
<li>rs接收数据包后，会还原原始数据包，这样目标IP为vip，因为所有rs上配置了这个vip，所以它会认为是它自己 </li>
</ul>
<h3 id="LVS-DR模式"><a href="#LVS-DR模式" class="headerlink" title="LVS DR模式"></a>LVS DR模式</h3><p>工作原理：Virtual Server via Director Server 分发器封装<br><strong>分发器将请求来的数据包的MAC地址改为后端的 real server的MAC地址，然后直接原封不动地把数据包发到后端的 real server上，而 real server 会直接把数据返回给客户端，也不再经过调度器，客户端接受的IP信息还是显示的是分发器的IP</strong></p>
<ul>
<li>这种模式，也需要有一个公共的IP配置在分发器和所有rs上，也就是vip  </li>
<li>和IP Tunnel不同的是，它会把数据包的MAC地址修改为rs的MAC地址  </li>
<li>rs接收数据包后，会还原原始数据包，这样目标IP为vip，因为所有rs上配置了这个vip，所以它会认为是它自己 </li>
</ul>
<p>官方三种负载均衡技术比较总结表：</p>
<h2 id="18-8-LVS调度算法"><a href="#18-8-LVS调度算法" class="headerlink" title="18.8 LVS调度算法"></a>18.8 LVS调度算法</h2><p>在这8种算法中，rr、wrr、lc、wlc四种算法是最最常用的，需要记住。</p>
<ol>
<li><p>轮询 Round-Robin  rr<br>这种算法是最简单的，就是按依次循环的方式将请求调度到不同的服务器上，该算法最大的特点就是简单。轮询算法假设所有的服务器处理请求的能力都是一样的，调度器会将所有的请求平均分配给每个真实服务器，不管后端 RS 配置和处理能力，非常均衡地分发下去。</p>
</li>
<li><p>加权轮询 Weight Round-Robin wrr<br>这种算法比 rr 的算法多了一个权重的概念，可以给 RS 设置权重，权重越高，那么分发的请求数越多，权重的取值范围 0 – 100。主要是对rr算法的一种优化和补充， LVS 会考虑每台服务器的性能，并给每台服务器添加要给权值，如果服务器A的权值为1，服务器B的权值为2，则调度到服务器B的请求会是服务器A的2倍。权值越高的服务器，处理的请求越多。</p>
</li>
<li><p>最小连接 Least-Connection lc<br>这个算法会根据后端 RS 的连接数来决定把请求分发给谁，比如 RS1 连接数比 RS2 连接数少，那么请求就优先发给 RS1</p>
</li>
<li><p>加权最小连接 Weight Least-Connection wlc<br>这个算法比 lc 多了一个权重的概念。</p>
</li>
<li><p>基于局部性的最小连接 Locality-Based Least Connections lblc<br>这个算法是请求数据包的目标 IP 地址的一种调度算法，该算法先根据请求的目标 IP 地址寻找最近的该目标 IP 地址所有使用的服务器，如果这台服务器依然可用，并且有能力处理该请求，调度器会尽量选择相同的服务器，否则会继续选择其它可行的服务器</p>
</li>
<li><p>带复制的基于局部性最小连接 Locality-Based Least Connections with Replication  lblcr<br>记录的不是要给目标 IP 与一台服务器之间的连接记录，它会维护一个目标 IP 到一组服务器之间的映射关系，防止单点服务器负载过高。</p>
</li>
<li><p>目标地址散列调度 Destination Hashing dh<br>该算法是根据目标 IP 地址通过散列函数将目标 IP 与服务器建立映射关系，出现服务器不可用或负载过高的情况下，发往该目标 IP 的请求会固定发给该服务器。</p>
</li>
<li><p>源地址散列调度 Source Hashing  sh<br>与目标地址散列调度算法类似，但它是根据源地址散列算法进行静态分配固定的服务器资源。</p>
</li>
</ol>
<h2 id="18-9-18-10-LVS-NAT模式搭建"><a href="#18-9-18-10-LVS-NAT模式搭建" class="headerlink" title="18.9/18.10 LVS NAT模式搭建"></a>18.9/18.10 LVS NAT模式搭建</h2><p>NAT模式就是通过iptables模式实现的，我们配置一些规则在上面就可以实现了。</p>
<h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h3><h4 id="1-1-三台服务器"><a href="#1-1-三台服务器" class="headerlink" title="1.1 三台服务器"></a>1.1 三台服务器</h4><table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>角色</th>
<th>网关</th>
</tr>
</thead>
<tbody><tr>
<td>yt-01</td>
<td>192.168.2.111</td>
<td>Director</td>
<td>公网IP （虚拟机的原因，公网IP同内网IP，生产环境中是不同的）</td>
</tr>
<tr>
<td>yt-02</td>
<td>192.168.2.112</td>
<td>Real server A</td>
<td>192.168.2.111（即DR的内网IP地址）</td>
</tr>
<tr>
<td>yt-03</td>
<td>192.168.2.113</td>
<td>Real server B</td>
<td>192.168.2.111（即DR的内网IP地址）</td>
</tr>
</tbody></table>
<p>配置完成后，最好 <code>route -n</code> 再确认下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-02 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination    Gateway        Genmask        Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0        192.168.2.111 0.0.0.0        UG    0      0        0 ens33</span><br></pre></td></tr></table></figure>

<h4 id="1-2-三台机器上都关闭掉防火墙，重置iptables规则"><a href="#1-2-三台机器上都关闭掉防火墙，重置iptables规则" class="headerlink" title="1.2 三台机器上都关闭掉防火墙，重置iptables规则"></a>1.2 三台机器上都关闭掉防火墙，重置iptables规则</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# systemctl stop firewalld</span><br><span class="line">[root@yt-01 ~]# systemctl disable firewalld</span><br><span class="line">[root@yt-01 ~]# systemctl start  iptables-services; iptables -F; service iptables save </span><br><span class="line">[root@yt-01 ~]# getenforce </span><br><span class="line">Enforcing</span><br><span class="line">[root@yt-01 ~]# vim /etc/sysconfig/selinux </span><br><span class="line"></span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#    enforcing - SELinux security policy is enforced.</span><br><span class="line">#    permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#    disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# yum install -y iptables-services  </span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# systemctl start iptables</span><br><span class="line">[root@yt-01 ~]# systemctl enable iptables</span><br><span class="line">Created symlink from /etc/systemd/system/basic.target.wants/iptables.service to /usr/lib/systemd/system/iptables.service.</span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# iptables -F</span><br><span class="line">[root@yt-01 ~]# service iptables save</span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]</span><br></pre></td></tr></table></figure>

<h4 id="1-3-测试内外之间是否可以ping同"><a href="#1-3-测试内外之间是否可以ping同" class="headerlink" title="1.3 测试内外之间是否可以ping同"></a>1.3 测试内外之间是否可以ping同</h4><p>Windows主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 192.168.2.111</span><br></pre></td></tr></table></figure>

<p>yt-01</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.qq.com</span><br></pre></td></tr></table></figure>

<h3 id="2-安装和配置"><a href="#2-安装和配置" class="headerlink" title="2.安装和配置"></a>2.安装和配置</h3><h4 id="2-1-在两个RS上面安装nginx"><a href="#2-1-在两个RS上面安装nginx" class="headerlink" title="2.1 在两个RS上面安装nginx"></a>2.1 在两个RS上面安装nginx</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-02 ~]# yum install -y nginx</span><br><span class="line">[root@yt-03 ~]# yum install -y nginx</span><br></pre></td></tr></table></figure>

<h4 id="2-2-在Director上安装ipvsadm"><a href="#2-2-在Director上安装ipvsadm" class="headerlink" title="2.2 在Director上安装ipvsadm"></a>2.2 在Director上安装ipvsadm</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# yum install -y ipvsadm</span><br></pre></td></tr></table></figure>

<h4 id="2-3-给Director编辑一个实现nat的脚本"><a href="#2-3-给Director编辑一个实现nat的脚本" class="headerlink" title="2.3 给Director编辑一个实现nat的脚本"></a>2.3 给Director编辑一个实现nat的脚本</h4><p>编写脚本 /usr/local/sbin/lvs_nat.sh，LVS架构几乎都是以脚本的形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# /usr/local/sbin/lvs_nat.sh</span><br><span class="line"></span><br><span class="line">#! /bin/bash</span><br><span class="line"># director 服务器上开启路由转发功能</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line"># 关闭icmp的重定向</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/all/send_redirects</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/default/send_redirects</span><br><span class="line"># 注意区分网卡名字，两个网卡分别为ens33和ens37</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/ens33/send_redirects</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/ens37/send_redirects</span><br><span class="line"># director 设置nat防火墙</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -X</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.2.0/24  -j MASQUERADE</span><br><span class="line"># director设置ipvsadm</span><br><span class="line">IPVSADM=&apos;/usr/sbin/ipvsadm&apos;</span><br><span class="line">$IPVSADM -C</span><br><span class="line">$IPVSADM -A -t 192.168.138.128:80 -s wlc -p 3</span><br><span class="line"># -s wlc -p 3 这就是IPVSADM算法，超时3s，Director服务器会自动分发到不同的Real Server服务器</span><br><span class="line">$IPVSADM -a -t 192.168.138.128:80 -r 192.168.2.112:80 -m -w 1</span><br><span class="line">$IPVSADM -a -t 192.168.138.128:80 -r 192.168.2.113:80 -m -w 1</span><br></pre></td></tr></table></figure>

<h4 id="2-4-执行DR上的lvs-nat-sh脚本"><a href="#2-4-执行DR上的lvs-nat-sh脚本" class="headerlink" title="2.4 执行DR上的lvs_nat.sh脚本"></a>2.4 执行DR上的lvs_nat.sh脚本</h4><p>保存后，运行脚本，LVS NAT模式就配置成功了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# sh /usr/local/sbin/lvs_nat.sh</span><br></pre></td></tr></table></figure>

<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h3><h4 id="3-1-修改2个RS的nginx主页内容，以便区分"><a href="#3-1-修改2个RS的nginx主页内容，以便区分" class="headerlink" title="3.1 修改2个RS的nginx主页内容，以便区分"></a>3.1 修改2个RS的nginx主页内容，以便区分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-02 ~]# echo &quot;rs1rs1&quot; &gt;/usr/share/nginx/html/index.html</span><br><span class="line">[root@yt-03 ~]# echo &quot;rs2rs2&quot; &gt;/usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure>

<h4 id="3-2-用浏览器测试两台机器上的web内容"><a href="#3-2-用浏览器测试两台机器上的web内容" class="headerlink" title="3.2 用浏览器测试两台机器上的web内容"></a>3.2 用浏览器测试两台机器上的web内容</h4><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="lvs-三种模式详解"><a href="#lvs-三种模式详解" class="headerlink" title="lvs 三种模式详解"></a>lvs 三种模式详解</h3><p><a href="http://www.it165.net/admin/html/201401/2248.html" target="_blank" rel="noopener">http://www.it165.net/admin/html/201401/2248.html</a> </p>
<h3 id="lvs几种算法"><a href="#lvs几种算法" class="headerlink" title="lvs几种算法"></a>lvs几种算法</h3><p><a href="http://www.aminglinux.com/bbs/thread-7407-1-1.html" target="_blank" rel="noopener">http://www.aminglinux.com/bbs/thread-7407-1-1.html</a></p>
<h3 id="关于arp-ignore和-arp-announce"><a href="#关于arp-ignore和-arp-announce" class="headerlink" title="关于arp_ignore和 arp_announce"></a>关于arp_ignore和 arp_announce</h3><p><a href="http://www.cnblogs.com/lgfeng/archive/2012/10/16/2726308.html" target="_blank" rel="noopener">http://www.cnblogs.com/lgfeng/archive/2012/10/16/2726308.html</a></p>
<h3 id="lvs原理相关的"><a href="#lvs原理相关的" class="headerlink" title="lvs原理相关的"></a>lvs原理相关的</h3><p><a href="http://blog.csdn.net/pi9nc/article/details/23380589" target="_blank" rel="noopener">http://blog.csdn.net/pi9nc/article/details/23380589</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/19.1-19.6 Linux监控平台介绍、zabbix监控介绍、安装、忘记密码怎么办/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/19.1-19.6 Linux监控平台介绍、zabbix监控介绍、安装、忘记密码怎么办/" itemprop="url">19.1-19.6 Linux监控平台介绍、zabbix监控介绍、安装、忘记密码怎么办</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="19-1-Linux监控平台介绍"><a href="#19-1-Linux监控平台介绍" class="headerlink" title="19.1 Linux监控平台介绍"></a>19.1 Linux监控平台介绍</h2><p>常见的Linux监控平台有cacti、nagios、zabbix、smokeping、open-falcon等等  </p>
<ul>
<li><p>cacti、smokeping偏向于基础监控，成图非常漂亮  </p>
</li>
<li><p>cacti、nagios、zabbix服务端监控中心，需要php环境支持，其中zabbix和cacti都需要mysql作为数据存储，nagios不用存储历史数据，注重服务或者监控项的状态，zabbix会获取服务或者监控项目的数据，会把数据记录到数据库里，从而可以成图 ，这几款软件都有web操作界面</p>
</li>
<li><p>open-falcon为小米公司开发，开源后受到诸多大公司和运维工程师的追捧，适合大企业，滴滴、360、新浪微博、京东等大公司在使用这款监控软件，值得研究  </p>
</li>
</ul>
<h2 id="19-2-zabbix监控介绍"><a href="#19-2-zabbix监控介绍" class="headerlink" title="19.2 zabbix监控介绍"></a>19.2 zabbix监控介绍</h2><p>C/S架构（被监控的server需要安装监控软件，既可以主动连接客户端，也可以被动的让客户端推送自己的状态），基于C++开发，监控中心支持web界面配置和管理。</p>
<p>单server节点可以支持上万台客户端（可支持同时上万台的server监控，并发量高，如果超过一定的量，性能可能会降低，但是我们可以增加Proxy代理点来充当监控服务器来减轻压力）</p>
<h3 id="5个组件"><a href="#5个组件" class="headerlink" title="5个组件"></a>5个组件</h3><ul>
<li><p><strong>zabbix-server 监控中心</strong>，接收客户端上报信息，负责配置、统计、操作数据。</p>
</li>
<li><p><strong>数据存储</strong> 存放数据，比如mysql。</p>
</li>
<li><p><strong>web界面 也叫web UI</strong>，在web界面下操作配置是zabbix简单易用的主要原因。</p>
</li>
<li><p><strong>zabbix-proxy 可选组件</strong>，它可以代替zabbix-server的功能，减轻server的压力。</p>
</li>
<li><p><strong>zabbix-agent 客户端软件</strong>，负责采集各个监控服务或项目的数据，并上报</p>
</li>
</ul>
<h3 id="zabbix监控流程图"><a href="#zabbix监控流程图" class="headerlink" title="zabbix监控流程图"></a>zabbix监控流程图</h3><h2 id="19-3-19-4-安装zabbix"><a href="#19-3-19-4-安装zabbix" class="headerlink" title="19.3/19.4 安装zabbix"></a>19.3/19.4 安装zabbix</h2><h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h3><p>因为Zabbix的特性，需要2至少2台服务器，1台监控服务端，1台客户端，还需要PHP和Mysql的环境支持，还有自带的web UI，还需要httpd支持。</p>
<p>| 主机名 | IP地址 | 角色 |<br>| — | ———— | —– | ————– |<br>| yt-01 | 192.168.2.130  | server |<br>| yt-02 | 192.168.2.131 |  cilent | </p>
<p>官网下载地址，系统自带yum源的2.2版本很老了，在此使用zabbix官方提供的对应版本的yum源安装较新版本的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.zabbix.com/download</span><br><span class="line"></span><br><span class="line">yum install make apr* autoconf automake curl-devel gcc gcc-c++ zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat* mpfr cpp glibc libgomp libstdc++-devel ppl cloog-ppl keyutils-libs-devel libcom_err-devel libsepol-devel libselinux-devel krb5-devel zlib-devel libXpm* freetype libjpeg* libpng* php-common php-gd ncurses* libtool* libxml2 libxml2-devel patch cmake</span><br></pre></td></tr></table></figure>

<p>我们先配置好服务端，再配置客户端。</p>
<h3 id="2-server安装zabbix"><a href="#2-server安装zabbix" class="headerlink" title="2. server安装zabbix"></a>2. server安装zabbix</h3><p>安装zabbix之前需要先安装其yum源仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 下载指定版本</span><br><span class="line">[root@yt-01 src]# wget repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"># 安装zabbix的yum扩展源</span><br><span class="line">[root@yt-01 src]# rpm -ivh zabbix-release-3.2-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"># 安装zabbix及其组件</span><br><span class="line">[root@yt-01 src]# yum install -y zabbix-agent zabbix-get zabbix-server-mysql zabbix-web zabbix-web-mysql</span><br><span class="line"></span><br><span class="line"># zabbix-agent是客户端程序</span><br><span class="line"># zabbix-get是服务端上命令行获取客户端检测项目的组件</span><br><span class="line"># zabbix-server-mysql是zabbix-server MySQL组件</span><br><span class="line"># zabbix-web是web界面组件</span><br><span class="line"># zabbix-web-mysql：web界面MySQL相关组件</span><br><span class="line"># 该过程会顺带安装上PHP和httpd服务。</span><br></pre></td></tr></table></figure>

<h3 id="3-安装和配置MySQL"><a href="#3-安装和配置MySQL" class="headerlink" title="3. 安装和配置MySQL"></a>3. 安装和配置MySQL</h3><h4 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h4><p>安装mysql可以使用两种方法：1. yum安装  2.编译mysql安装，可参考之前LAMP安装的过程<br>这里选择直接yum安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 src]# yum install -y mysql mysql-server mysql-devel </span><br><span class="line"></span><br><span class="line">[root@yt-01 src]# wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">ls -1 /etc/yum.repos.d/mysql-community*</span><br><span class="line">yum install mysql-server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@yt-01 src]# systemctl start mysqld</span><br><span class="line"></span><br><span class="line">[root@yt-01 src]# ps aux | grep mysql</span><br></pre></td></tr></table></figure>

<h4 id="配置MySQL"><a href="#配置MySQL" class="headerlink" title="配置MySQL"></a>配置MySQL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 src]# vim /etc/my.cnf </span><br><span class="line"></span><br><span class="line"># 需要增加配置。设置默认字符集的目的是让web UI可以正常的用中文显示。</span><br><span class="line">character_set_server = utf8</span><br><span class="line"></span><br><span class="line"># 重启mysqld服务</span><br><span class="line">[root@yt-01 src]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">#进入mysql，创建zabbix库（类似安装wordpress，zabbix的web UI就是一个php写的监控网站）</span><br><span class="line">[root@yt-01 ~]# mysql -uroot -p123456</span><br><span class="line">mysql&gt; create database zabbix character set utf8;</span><br><span class="line">#创建库并指定其字符集    </span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on zabbix.* to &apos;zabbix&apos;@&apos;127.0.0.1&apos; identified by &apos;123456&apos;; </span><br><span class="line"># 允许账户zabbix能从本机连接到数据库zabbix</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>

<h3 id="4-导入zabbix自带的数据库"><a href="#4-导入zabbix自带的数据库" class="headerlink" title="4. 导入zabbix自带的数据库"></a>4. 导入zabbix自带的数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 进入zabbix自带的数据库目录</span><br><span class="line">[root@yt-01 ~]# cd /usr/share/doc/zabbix-server-mysql-3.2.11/</span><br><span class="line">[root@yt-01 zabbix-server-mysql-3.2.11]# ls</span><br><span class="line">AUTHORS  ChangeLog  COPYING  create.sql.gz  NEWS  README</span><br><span class="line"></span><br><span class="line"># 解压create.sql.gz包，导入到新建的zabbix库</span><br><span class="line">[root@zhdy-01 zabbix-server-mysql-3.2.11]# gzip -d create.sql.gz</span><br><span class="line">[root@z1 zabbix-server-mysql-3.2.11]# mysql -uroot -p123456 zabbix &lt; create.sql</span><br></pre></td></tr></table></figure>

<h3 id="5-启动zabbix服务"><a href="#5-启动zabbix服务" class="headerlink" title="5. 启动zabbix服务"></a>5. 启动zabbix服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 启动zabbix服务</span><br><span class="line">[root@yt-01 zabbix-server-mysql-3.2.11]# systemctl start zabbix-server</span><br><span class="line"></span><br><span class="line"># 启动http服务（如果之前有配置nginx，或者tomcat（配置了80端口）服务一定要先停掉。不然启动httpd会报错）</span><br><span class="line">[root@yt-01 zabbix-server-mysql-3.2.11]# systemctl start httpd.service</span><br><span class="line">[root@yt-01 zabbix-server-mysql-3.2.11]# netstat -lntp |grep httpd</span><br><span class="line">tcp6      0      0 :::80                  :::*                    LISTEN      2370/httpd      </span><br><span class="line"></span><br><span class="line"># 把zabbix、http等服务设置开机启动  </span><br><span class="line">[root@yt-01 ~]# systemctl enable zabbix-server</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-server.service to /usr/lib/systemd/system/zabbix-server.service.</span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# systemctl enable httpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure>

<h3 id="6-查看zabbix的日志"><a href="#6-查看zabbix的日志" class="headerlink" title="6. 查看zabbix的日志"></a>6. 查看zabbix的日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# less /var/log/zabbix/zabbix_server.log</span><br></pre></td></tr></table></figure>

<h3 id="7-配置zabbix"><a href="#7-配置zabbix" class="headerlink" title="7. 配置zabbix"></a>7. 配置zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# vim /etc/zabbix/zabbix_server.conf </span><br><span class="line"># 更改配置文件</span><br><span class="line"></span><br><span class="line">DBHost=127.0.0.1</span><br><span class="line"># 此处写的是本机MySQL的IP，实际生产环境中zabbix可能单独使用一台机器，则要填实际IP地址</span><br><span class="line"># 该IP应该和数据库授权时指定的IP一致</span><br><span class="line">DBname=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br><span class="line"></span><br><span class="line"># 更改完成后，重启zabbix服务</span><br><span class="line">[root@z1 ~]# systemctl restart zabbix-server.service</span><br><span class="line"></span><br><span class="line"># 启动完成后查看其状态</span><br><span class="line">[root@z1 ~]# ps aux |grep zabbix</span><br><span class="line"></span><br><span class="line">netstat -lntp |grep zabbix</span><br><span class="line">tcp 0 0 0.0.0.0:10051 0.0.0.0:* LISTEN 2657/zabbix_server</span><br><span class="line">tcp6 0 0 :::10051 :::* LISTEN 2657/zabbix_server </span><br><span class="line">服务端zabbix默认监听10051端口</span><br></pre></td></tr></table></figure>

<h3 id="8-安装和配置zabbix-web界面"><a href="#8-安装和配置zabbix-web界面" class="headerlink" title="8. 安装和配置zabbix web界面"></a>8. 安装和配置zabbix web界面</h3><p>使用浏览器访问server机器上的<code>IP：192.168.122.130/zabbix</code>进入安装引导界面，进行该操作前保证server已关闭防火墙。</p>
<p>点击“Next step”进入检测界面</p>
<p><strong>错误</strong>： 此处有错误提示，意识是PHP无法识别“data.timezone”（时区）</p>
<p><strong>解决办法</strong>：编辑PHP配置文件，更改时区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 修改时区</span><br><span class="line">[root@yt-01 ~]# vim /etc/php.ini </span><br><span class="line">date.timezone =Asia/Shanghai</span><br><span class="line"></span><br><span class="line"># 重启httpd服务</span><br><span class="line">[root@yt-02 ~]# systemctl restart httpd.service</span><br></pre></td></tr></table></figure>

<p>浏览器刷新，问题解决！然后，继续点击“Next step”，配置数据库信息</p>
<p>点击“Next step”，设置服务器用户名（自定义）</p>
<p>继续点击“Next step”，至出现提示界面</p>
<p>已经安装完成！</p>
<p>完成，进入管理界面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">初始用户名Admin 密码zabbix</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 切记：配置好了之后，第一件事情</span><br><span class="line"></span><br><span class="line"># 更改密码！更改密码！更改密码！</span><br><span class="line"></span><br><span class="line"># Administration→Users→Admin→Change password</span><br><span class="line"></span><br><span class="line"># 并且在修改密码下，可以更改web界面为中文。</span><br></pre></td></tr></table></figure>

<h2 id="19-6-zabbix客户端配置"><a href="#19-6-zabbix客户端配置" class="headerlink" title="19.6 zabbix客户端配置"></a>19.6 zabbix客户端配置</h2><h3 id="1-安装Zabbix客户端"><a href="#1-安装Zabbix客户端" class="headerlink" title="1. 安装Zabbix客户端"></a>1. 安装Zabbix客户端</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 下载指定版本</span><br><span class="line">[root@yt-02 ~]# wget repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"># 安装zabbix的yum扩展源</span><br><span class="line">[root@yt-02 ~]# rpm -ivh zabbix-release-3.2-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"># client端仅仅只需要安装服务</span><br><span class="line">[root@yt-02 ~]# yum install -y zabbix-agent</span><br><span class="line"></span><br><span class="line"># 配置mysql</span><br><span class="line">（略）</span><br></pre></td></tr></table></figure>

<h3 id="2-配置zabbix"><a href="#2-配置zabbix" class="headerlink" title="2. 配置zabbix"></a>2. 配置zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-02 ~]# vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line"># 增加如下配置</span><br><span class="line"></span><br><span class="line">Server=192.168.2.130</span><br><span class="line">#定义监控服务端的ip</span><br><span class="line">ServerActive=192.168.2.130</span><br><span class="line">#定义监控服务端的ip，不过该参数决定了监控的 主/被动模式</span><br><span class="line">#如果只有参数Server，则采用被动模式（只能等待服务端来采集信息）</span><br><span class="line">#设置此参数，则为主动模式（客户端主动向服务端发送信息）</span><br><span class="line">Hostname=yt-02 </span><br><span class="line">#定义客户端主机名字，只是便于服务端识别，不参与实际的控制</span><br><span class="line"></span><br><span class="line"># 启动zabbix服务</span><br><span class="line">[root@yt-02 ~]# systemctl start zabbix-agent.service </span><br><span class="line"></span><br><span class="line"># 查看进程是否运行</span><br><span class="line">[root@yt-02 ~]# ps aux | grep zabbix</span><br><span class="line"></span><br><span class="line"># 查看监控的端口，默认端口是10050</span><br><span class="line">[root@yt-02 src]# netstat -lntp|grep zabbix</span><br><span class="line">tcp 0 0 0.0.0.0:10050 0.0.0.0:* LISTEN 1897/zabbix_agentd</span><br><span class="line">tcp6 0 0 :::10050 :::* LISTEN 1897/zabbix_agentd</span><br><span class="line"></span><br><span class="line"># 设置为开机运行</span><br><span class="line">[root@yt-02 ~]# systemctl enable zabbix-agent</span><br></pre></td></tr></table></figure>

<h2 id="19-5-忘记Admin密码如何做"><a href="#19-5-忘记Admin密码如何做" class="headerlink" title="19.5 忘记Admin密码如何做"></a>19.5 忘记Admin密码如何做</h2><p>修改zabbix的管理员密码（web界面）这个和修改wordpress以及修改mysql自身登录密码是类似的，直接在数据库内选中数据库选中user表进行修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# mysql -uroot -p</span><br><span class="line"># 切换到zabbix库</span><br><span class="line">&gt; show databases;</span><br><span class="line">&gt; use zabbix;</span><br><span class="line">&gt; show tabales;</span><br><span class="line">&gt; desc users;</span><br><span class="line">+----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| userid | bigint(20) unsigned | NO | PRI | NULL | |</span><br><span class="line">| alias | varchar(100) | NO | UNI | | |</span><br><span class="line">| name | varchar(100) | NO | | | |</span><br><span class="line">| surname | varchar(100) | NO | | | |</span><br><span class="line">| passwd | char(32) | NO | | | |</span><br><span class="line">| url | varchar(255) | NO | | | |</span><br><span class="line">| autologin | int(11) | NO | | 0 | |</span><br><span class="line">| autologout | int(11) | NO | | 900 | |</span><br><span class="line">| lang | varchar(5) | NO | | en_GB | |</span><br><span class="line">| refresh | int(11) | NO | | 30 | |</span><br><span class="line">| type | int(11) | NO | | 1 | |</span><br><span class="line">| theme | varchar(128) | NO | | default | |</span><br><span class="line">| attempt_failed | int(11) | NO | | 0 | |</span><br><span class="line">| attempt_ip | varchar(39) | NO | | | |</span><br><span class="line">| attempt_clock | int(11) | NO | | 0 | |</span><br><span class="line">| rows_per_page | int(11) | NO | | 50 | |</span><br><span class="line">+----------------+---------------------+------+-----+---------+-------+</span><br><span class="line">16 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更改密码</span><br><span class="line">mysql&gt; update users set passwd=md5(&apos;123456&apos;) where alias=&apos;Admin&apos;;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line">mysql&gt; quit</span><br><span class="line"></span><br><span class="line">这样就成功修改了zabbix管理web的登录密码为123456！</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/21.13-21.17 redis常用操作、操作键值、安全设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/21.13-21.17 redis常用操作、操作键值、安全设置/" itemprop="url">21.13-21.17 redis常用操作、操作键值、安全设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="21-13-21-14-21-15-redis常用操作"><a href="#21-13-21-14-21-15-redis常用操作" class="headerlink" title="21.13/21.14/21.15 redis常用操作"></a>21.13/21.14/21.15 redis常用操作</h1><h2 id="1-Redis常用操作-for-String数据"><a href="#1-Redis常用操作-for-String数据" class="headerlink" title="1 Redis常用操作 for String数据"></a>1 Redis常用操作 for String数据</h2><ul>
<li><p>SETNX 检测键值是否有value，如果有直接返回一个 0，如果没有直接返回一个 1 并且创建此 value。(string)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">如果一个key设置两个不同的值，第二个值会覆盖第一个值。</span><br><span class="line"># redis-cli </span><br><span class="line">127.0.0.1:6379&gt; set key1 yun</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set key2 tai</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set key1 awkk</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;awkk&quot;</span><br><span class="line"></span><br><span class="line">使用setnx命令检测</span><br><span class="line">127.0.0.1:6379&gt; SETNX key1 aaa</span><br><span class="line">(integer) 0      </span><br><span class="line">127.0.0.1:6379&gt; SETNX key3 aaa</span><br><span class="line">(integer) 1     </span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;awkk&quot;</span><br><span class="line">127.0.0.1:6379&gt; get key3</span><br><span class="line">&quot;aaa&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>setex 针对某个key设置一个过期时间。(string)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setex key3 10 1            //给key3设置过期时间为10s，值为1，若key已经存在，会覆盖新的值。</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="2-Redis常用操作-for-List数据"><a href="#2-Redis常用操作-for-List数据" class="headerlink" title="2 Redis常用操作 for List数据"></a>2 Redis常用操作 for List数据</h2><ul>
<li><p>LPUSH 插入值、LPOP  取（挤）出值、lrange 列出值（范围）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPUSH kk 222     //从左侧添加一个数据，相当于从瓶子上方往里面放饼干，先存的在里面，后存的在外边</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH kk 111</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH kk 2222    </span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE kk 0 -1     </span><br><span class="line">1) &quot;2222&quot;</span><br><span class="line">2) &quot;111&quot;</span><br><span class="line">3) &quot;222&quot;</span><br><span class="line">127.0.0.1:6379&gt; LPOP kk       //LPOP 取最上面的值</span><br><span class="line">&quot;2222&quot;</span><br><span class="line">127.0.0.1:6379&gt; RPOP kk       //RPOP 取最下面的值</span><br><span class="line">&quot;222&quot;</span><br><span class="line"># 注意：RPOP 或者 LPOP只要把值取出来 其中的值就会被删除掉。</span><br></pre></td></tr></table></figure>
</li>
<li><p>Linsert 插入一个值   before在前面/after在后面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LRANGE kk1 0 -1</span><br><span class="line">1) &quot;333&quot;</span><br><span class="line">2) &quot;asd&quot;</span><br><span class="line">3) &quot;111&quot;</span><br><span class="line">在之前插入一个数值：</span><br><span class="line">127.0.0.1:6379&gt; LINSERT kk1 before 333 zzz</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE kk1 0 -1</span><br><span class="line">1) &quot;zzz&quot;</span><br><span class="line">2) &quot;333&quot;</span><br><span class="line">3) &quot;asd&quot;</span><br><span class="line">4) &quot;111&quot;</span><br><span class="line">在之后插入一个数值：</span><br><span class="line">127.0.0.1:6379&gt; LINSERT kk1 after asd sss</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE kk1 0 -1</span><br><span class="line">1) &quot;zzz&quot;</span><br><span class="line">2) &quot;333&quot;</span><br><span class="line">3) &quot;asd&quot;</span><br><span class="line">4) &quot;sss&quot;</span><br><span class="line">5) &quot;111&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>LSET 修改一个值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LRANGE kk1 0 -1</span><br><span class="line">1) &quot;zzz&quot;</span><br><span class="line">2) &quot;333&quot;</span><br><span class="line">3) &quot;asd&quot;</span><br><span class="line">4) &quot;sss&quot;</span><br><span class="line">5) &quot;111&quot;</span><br><span class="line">127.0.0.1:6379&gt; LSET kk1 1 555    //把第二个值 333 改为 555（首个数值是从0 开始的）</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE kk1 0 -1</span><br><span class="line">1) &quot;zzz&quot;</span><br><span class="line">2) &quot;555&quot;</span><br><span class="line">3) &quot;asd&quot;</span><br><span class="line">4) &quot;sss&quot;</span><br><span class="line">5) &quot;111&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>LINDEX 查看元素的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lindex kk1 0 //查看第1个元素</span><br><span class="line">lindex kk1 3 //查看第4个元素</span><br></pre></td></tr></table></figure>
</li>
<li><p>LLEN 查看元素的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LLEN kk1</span><br><span class="line">(integer) 5</span><br><span class="line">表示有5个元素</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="3-Redis常用操作-for-Set（zset）数据"><a href="#3-Redis常用操作-for-Set（zset）数据" class="headerlink" title="3 Redis常用操作 for Set（zset）数据"></a>3 Redis常用操作 for Set（zset）数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SADD pp 111   //向集合pp中放入元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD pp 222</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD pp 333</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS pp   //查看集合中的所有元素</span><br><span class="line">1) &quot;111&quot;</span><br><span class="line">2) &quot;222&quot;</span><br><span class="line">3) &quot;333&quot;</span><br><span class="line">127.0.0.1:6379&gt; SPOP pp   //随机取出一个元素，删除</span><br><span class="line">&quot;111&quot;</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS pp</span><br><span class="line">1) &quot;111&quot;</span><br><span class="line">2) &quot;222&quot;</span><br><span class="line">3) &quot;333&quot;</span><br><span class="line">127.0.0.1:6379&gt; SREM pp 111   //删除一个元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS pp</span><br><span class="line">1) &quot;222&quot;</span><br><span class="line">2) &quot;333&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>SDIFF 求差集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SMEMBERS pp</span><br><span class="line">1) &quot;222&quot;</span><br><span class="line">2) &quot;333&quot;</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS mm</span><br><span class="line">1) &quot;221&quot;</span><br><span class="line">2) &quot;222&quot;</span><br><span class="line">3) &quot;233&quot;</span><br><span class="line">127.0.0.1:6379&gt; SDIFF pp mm</span><br><span class="line">1) &quot;333&quot;</span><br><span class="line">127.0.0.1:6379&gt; SDIFF mm pp</span><br><span class="line">1) &quot;221&quot;</span><br><span class="line">2) &quot;233&quot;</span><br><span class="line">第一个SDIFF pp在前 mm在后 意思是针对于pp 对照mm找出不同的值</span><br><span class="line">第一个SDIFF mm在前 pp在后 意思是针对于mm 对照pp找出不同的值</span><br><span class="line">127.0.0.1:6379&gt; SDIFFstore nn mm pp //求差集并且存储，存储到了nn里</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS nn</span><br><span class="line">1) &quot;221&quot;</span><br><span class="line">2) &quot;233&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SINTER 求交集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SMEMBERS pp</span><br><span class="line">1) &quot;222&quot;</span><br><span class="line">2) &quot;333&quot;</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS mm</span><br><span class="line">1) &quot;221&quot;</span><br><span class="line">2) &quot;222&quot;</span><br><span class="line">3) &quot;233&quot;</span><br><span class="line">127.0.0.1:6379&gt; SINTER mm pp</span><br><span class="line">1) &quot;222&quot;</span><br><span class="line">127.0.0.1:6379&gt; SINTERSTORE aa mm pp //求交集并且存储，存储到了aa里</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS aa</span><br><span class="line">1) &quot;222&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SISMEMBER 判断集合中是否有此值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SMEMBERS mm</span><br><span class="line">1) &quot;221&quot;</span><br><span class="line">2) &quot;222&quot;</span><br><span class="line">3) &quot;233&quot;</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER mm 11</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER mm 233</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZADD 创建有序集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD ss 1 123</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD ss 2 234</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD ss 3 asd</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1 //显示所有元素，按顺序显示</span><br><span class="line">1) &quot;123&quot;</span><br><span class="line">2) &quot;234&quot;</span><br><span class="line">3) &quot;asd&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZREM ss 234 //删除指定元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1</span><br><span class="line">1) &quot;123&quot;</span><br><span class="line">2) &quot;asd&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZRANK 索引数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1</span><br><span class="line">1) &quot;123&quot;</span><br><span class="line">2) &quot;asd&quot;</span><br><span class="line">3) &quot;asdaqwe&quot;</span><br><span class="line">4) &quot;asasdz&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANK ss asd //返回元素的索引值，索引值从0开始，按score正向排序</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZRANK ss asasdz</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANK ss asd //按score反向排序，获取数据的值</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZCARD 统计集合元素中的个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZCARD ss</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZCOUNT 统计范围内集合元素的个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZCOUNT ss 1 10 //返回分值范围1-10的元素个数</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZRANGEBYSCORE 返回分值范围的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE ss 1 10</span><br><span class="line">1) &quot;123&quot;</span><br><span class="line">2) &quot;asd&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZREMRANGEBYSCORE 删除分值范围的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYSCORE ss 1 10</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1</span><br><span class="line">1) &quot;asdaqwe&quot;</span><br><span class="line">2) &quot;asasdz&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ZREMRANGEBYRANK 删除索引范围的元素，按score正向排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1</span><br><span class="line">1) &quot;asdaqwe&quot;</span><br><span class="line">2) &quot;123&quot;</span><br><span class="line">3) &quot;234&quot;</span><br><span class="line">4) &quot;345&quot;</span><br><span class="line">5) &quot;asdaa&quot;</span><br><span class="line">6) &quot;asasdz&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYRANK ss 1 10</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE ss 0 -1</span><br><span class="line">1) &quot;asdaqwe&quot;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="4-Redis常用操作-for-hash数据"><a href="#4-Redis常用操作-for-hash数据" class="headerlink" title="4 Redis常用操作 for hash数据"></a>4 Redis常用操作 for hash数据</h2><ul>
<li><p>HMSET 批量建立键值对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HMSET yt name yuntai age 27 weight 77</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; HGETALL yt</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;yuntai&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">4) &quot;27&quot;</span><br><span class="line">5) &quot;weight&quot;</span><br><span class="line">6) &quot;77&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HMGET 查询一个键值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HMGET yt name</span><br><span class="line">1) &quot;yuntai&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HDEL 删除一个键值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HDEL yt name</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HGETALL yt</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;27&quot;</span><br><span class="line">3) &quot;weight&quot;</span><br><span class="line">4) &quot;77&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HKEYS 打印所有的键值 HVALS 打印所有的values</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HKEYS yt</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;weight&quot;</span><br><span class="line">127.0.0.1:6379&gt; HVALS yt</span><br><span class="line">1) &quot;27&quot;</span><br><span class="line">2) &quot;77&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>hlen 查看有几个filed</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HLEN yt</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="21-16-redis操作键值"><a href="#21-16-redis操作键值" class="headerlink" title="21.16 redis操作键值"></a>21.16 redis操作键值</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">查看数据库内所有key：</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line"> 1) &quot;hseta&quot;</span><br><span class="line"> 2) &quot;k3&quot;</span><br><span class="line"> 3) &quot;setb&quot;</span><br><span class="line"> 4) &quot;hash1&quot;</span><br><span class="line"> 5) &quot;zseta&quot;</span><br><span class="line"> 6) &quot;mykey&quot;</span><br><span class="line"> 7) &quot;set3&quot;</span><br><span class="line"> 8) &quot;key2&quot;</span><br><span class="line"> 9) &quot;set2&quot;</span><br><span class="line">10) &quot;set4&quot;</span><br><span class="line">11) &quot;key1&quot;</span><br><span class="line">12) &quot;list2&quot;</span><br><span class="line">13) &quot;k1&quot;</span><br><span class="line">14) &quot;seta&quot;</span><br><span class="line">15) &quot;list1&quot;</span><br><span class="line">16) &quot;k2&quot;</span><br><span class="line">17) &quot;set1&quot;</span><br><span class="line">18) &quot;set5&quot;</span><br><span class="line"></span><br><span class="line">支持模糊匹配：</span><br><span class="line">127.0.0.1:6379&gt; keys set*</span><br><span class="line">1) &quot;setb&quot;</span><br><span class="line">2) &quot;set3&quot;</span><br><span class="line">3) &quot;set2&quot;</span><br><span class="line">4) &quot;set4&quot;</span><br><span class="line">5) &quot;seta&quot;</span><br><span class="line">6) &quot;set1&quot;</span><br><span class="line">7) &quot;set5&quot;</span><br><span class="line"></span><br><span class="line">查看某key是否存在：</span><br><span class="line">127.0.0.1:6379&gt; exists key1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; exists key11</span><br><span class="line">(integer) 0</span><br><span class="line">#0：表示不存在；1：表示存在</span><br><span class="line"></span><br><span class="line">删除key：</span><br><span class="line">127.0.0.1:6379&gt; del key1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; exists key1</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line">给已存在的key设置过期时间：</span><br><span class="line">127.0.0.1:6379&gt; EXPIRE key2 600</span><br><span class="line"></span><br><span class="line">查看某key还有多长时间过期：</span><br><span class="line">127.0.0.1:6379&gt; ttl key2</span><br><span class="line">(integer) 578</span><br><span class="line">#当key已经不存在时，返回-2</span><br><span class="line">#当key存在但是没有设置失效时间时，返回-1</span><br><span class="line"></span><br><span class="line">选择数据库：</span><br><span class="line">127.0.0.1:6379&gt; select 0</span><br><span class="line">OK</span><br><span class="line">#Redis有16个库，0表示当前所在的库</span><br><span class="line"></span><br><span class="line">将一个 key移动到另一个库：</span><br><span class="line">127.0.0.1:6379&gt; move set2 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) &quot;set2&quot;</span><br><span class="line"></span><br><span class="line">取消某个key的过期时间（persist）：</span><br><span class="line">127.0.0.1:6379&gt; ttl key2</span><br><span class="line">(integer) 221</span><br><span class="line">127.0.0.1:6379&gt; persist key2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl key2</span><br><span class="line">(integer) -1</span><br><span class="line"></span><br><span class="line">随机返回一个key：</span><br><span class="line">127.0.0.1:6379&gt; randomkey</span><br><span class="line">&quot;zseta&quot;</span><br><span class="line">127.0.0.1:6379&gt; randomkey</span><br><span class="line">&quot;mykey&quot;</span><br><span class="line"></span><br><span class="line">重命名：</span><br><span class="line">127.0.0.1:6379&gt; rename set2 set22</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; smembers set2</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; smembers set22</span><br><span class="line">1) &quot;d&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">3) &quot;eee&quot;</span><br><span class="line"></span><br><span class="line">查看key的类型：</span><br><span class="line">127.0.0.1:6379&gt; type key2</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; type set22</span><br><span class="line">set</span><br><span class="line">127.0.0.1:6379&gt; type zseta</span><br><span class="line">zset</span><br><span class="line">127.0.0.1:6379&gt; type list2</span><br><span class="line">list</span><br><span class="line">127.0.0.1:6379&gt; type hseta</span><br><span class="line">hash</span><br><span class="line"></span><br><span class="line">查看数据库找那个key的数目：</span><br><span class="line">127.0.0.1:6379&gt; DBSIZE</span><br><span class="line">(integer) 17</span><br><span class="line"></span><br><span class="line">查看数据库的状态信息：</span><br><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line"></span><br><span class="line">清空当前数据库内所有key：</span><br><span class="line">127.0.0.1:6379&gt; select 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) &quot;set22&quot;</span><br><span class="line">127.0.0.1:6379[1]&gt; flushdb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">(empty list or set)</span><br><span class="line"></span><br><span class="line">清空所有数据库内所有的key：</span><br><span class="line">127.0.0.1:6379&gt; flushall</span><br><span class="line"></span><br><span class="line">保存数据到rdb文件中，在后台运行：</span><br><span class="line">127.0.0.1:6379&gt; bgsav</span><br><span class="line">同上，在前台运行：</span><br><span class="line">127.0.0.1:6379&gt; save</span><br><span class="line"></span><br><span class="line">获取所有配置参数：</span><br><span class="line">127.0.0.1:6379&gt; config get *</span><br><span class="line"></span><br><span class="line">查看指定参数：</span><br><span class="line">127.0.0.1:6379&gt; config get port</span><br><span class="line">1) &quot;port&quot;</span><br><span class="line">2) &quot;6379&quot;</span><br><span class="line"></span><br><span class="line">设置某参数：</span><br><span class="line">27.0.0.1:6379&gt; config set timeout 100</span><br></pre></td></tr></table></figure>

<h2 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h2><p>首先定义或确定dir目录和dbfilename，然后把备份的rdb文件放到dir目录下面，重启Redis即可恢复数据。</p>
<h1 id="21-17-redis安全设置"><a href="#21-17-redis安全设置" class="headerlink" title="21.17 redis安全设置"></a>21.17 redis安全设置</h1><p>谈到安全，先说一个真实的例子：前两年Redis比较火的时候，也就是攻击最严重的时候。见到了很多次由Redis被黑导致系统被黑的案例！<br>怎么被黑的呢？</p>
<blockquote>
<p>Redis 服务启动了，但是监听了一个全网IP，如果6379默认端口没有更改，并且iptables也处于关闭，公网IP 也开放着，Redis也没有设置任何密码，黑客就会扫描端口，然后就可以轻轻松松登录你的Redis服务器，并且是超级管理员的权限。然后黑客就可以设置<strong>dir dbname</strong>， dir 定义到/root/.ssh 且dbname定义为：<strong>.ssh/authorized_keys</strong> 再把这个值写上自己的公钥。 这些应该都不陌生吧，这不就活生生的把黑客的公钥上传到了咱们的服务器中，然后利用超级管理员做任何想做的事情了！！<br>当然解决也很简单：1.设置密码 2.更改默认端口 3.监听内网IP 4.设定专用账户 5.修改configure命令</p>
</blockquote>
<p><code>vim /etc/redis.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">设置监听ip</span><br><span class="line">bind 127.0.0.1 2.2.2.2//可以是多个ip，用空格分隔</span><br><span class="line"></span><br><span class="line">设置监听端口</span><br><span class="line">port 16000</span><br><span class="line"></span><br><span class="line">设置密码</span><br><span class="line">requirepass passwd123</span><br><span class="line">redis-cli -a &apos;passwd123&apos;</span><br><span class="line"></span><br><span class="line">将config命令改名</span><br><span class="line">rename-command CONFIG xxx</span><br><span class="line"></span><br><span class="line">禁掉config命令</span><br><span class="line">rename-command CONFIG “”</span><br></pre></td></tr></table></figure>

<p>最后重启 redis 服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># killall redis-server</span><br><span class="line"># redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure>

<p>再次登陆 redis server 我们发现需要密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SADD asd 12</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">[root@zhdy-01 ~]# redis-cli -a &apos;asd9577&apos;</span><br><span class="line">127.0.0.1:6379&gt; SADD asd 12</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>我们还可以使用如上所讲的 更改config 为自定义名称，就算黑客登录了你的redis服务器也不晓得你们的config是什么命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# vim /etc/redis.conf</span><br><span class="line">添加：rename-command CONFIG xxx</span><br><span class="line">[root@yt-01 ~]# killall redis-server</span><br><span class="line">[root@yt-01 ~]# redis-server /etc/redis.conf</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET *</span><br><span class="line">(error) ERR unknown command &apos;CONFIG&apos;</span><br><span class="line">127.0.0.1:6379&gt; xxx GET *</span><br><span class="line">  1) &quot;dbfilename&quot;</span><br><span class="line">  2) &quot;dump.rdb&quot;</span><br><span class="line">  3) &quot;requirepass&quot;</span><br><span class="line">  4) &quot;xxx9577&quot;</span><br><span class="line">  5) &quot;masterauth&quot;</span><br><span class="line">  6) &quot;&quot;</span><br><span class="line">  7) &quot;cluster-announce-ip&quot;</span><br><span class="line">  8) &quot;&quot;</span><br><span class="line">  9) &quot;unixsocket&quot;</span><br></pre></td></tr></table></figure>

<p>最后一个就是禁掉 CONFIG </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/redis.conf </span><br><span class="line"></span><br><span class="line">把 # rename-commond CONFIG &quot; &quot;去掉前面的注释</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/21.1-21.4 NoSQL和memcached介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/21.1-21.4 NoSQL和memcached介绍/" itemprop="url">21.1-21.4 NoSQL和memcached介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="21-1-nosql介绍"><a href="#21-1-nosql介绍" class="headerlink" title="21.1 nosql介绍"></a>21.1 nosql介绍</h2><h3 id="1-什么是NoSQL？"><a href="#1-什么是NoSQL？" class="headerlink" title="1. 什么是NoSQL？"></a>1. 什么是NoSQL？</h3><ul>
<li><p><strong>非关系型数据库</strong>就是NoSQL，而<strong>关系型数据库</strong>代表MySQL  </p>
</li>
<li><p>对于<strong>关系型数据库</strong>来说，是需要把数据存储到库、表、行、字段里，<strong>查询的时候根据条件一行一行地去匹配</strong>，当量非常大的时候就很耗费时间和资源，*<em>尤其是数据是需要从磁盘里去检索 *</em> </p>
</li>
<li><p>NoSQL数据库存储原理非常简单（<strong>典型的数据类型为k-v</strong>），不存在繁杂的关系链，比如mysql查询的时候，需要找到对应的库、表（通常是多个表）以及字段。  </p>
</li>
<li><p>NoSQL数据可以<strong>存储在内存里</strong>，查询速度非常快  </p>
</li>
<li><p>NoSQL在性能表现上虽然能优于关系型数据库，但是它并不能完全替代关系型数据库  </p>
</li>
<li><p>NoSQL因为没有复杂的数据结构，扩展非常容易，支持分布式 </p>
</li>
</ul>
<h3 id="2-常见NoSQL数据库"><a href="#2-常见NoSQL数据库" class="headerlink" title="2. 常见NoSQL数据库"></a>2. 常见NoSQL数据库</h3><ul>
<li><strong>k-v形式的：memcached、redis</strong> 适合储存用户信息，比如会话、配置文件、参数、购物车等等。这些信息一般都和ID（键）挂钩，这种情景下键值数据库是个很好的选择。</li>
<li><strong>文档数据库：mongodb</strong>  将数据以文档的形式储存。每个文档都是一系列数据项的集合。每个数据项都有一个名称与对应的值，值既可以是简单的数据类型，如字符串、数字和日期等；也可以是复杂的类型，如有序列表和关联对象。数据存储的最小单位是文档，同一个表中存储的文档属性可以是不同的，数据可以使用XML、JSON或者JSONB等多种形式存储。</li>
<li><strong>列存储：Hbase</strong></li>
<li><strong>图：Neo4J、Infinite Graph、OrientDB</strong></li>
</ul>
<blockquote>
<p>例如现实运维环境中，我们一台WEB安装了一个Discuz，随着访问量的增加，数据库扛不住那么大的压力；怎么办呢？我们设置一个NoSQL，当用户读取完毕后会直接放在NoSQL中，当用户再次读取的时候，会直接从缓存中读取，不需要再次从数据库中读取。帖子的ID就类似于Key，帖子的内容就类似于Value。</p>
</blockquote>
<blockquote>
<p>NoSQL因为没有复杂的数据结构，扩展非常容易，支持分布式。所以扩展也比较容易。如果你的A服务器受到瓶颈，增加服务器让让其继续缓存呗，因为不像关系型数据库需要互相关联，NoSQL直接横向扩展即可！</p>
</blockquote>
<blockquote>
<p>mysql的话只有前面说到的主主，主从，多主多从针对从进行负载均衡。要么就是分库分表，前提是关联的数据库不可以分开，不关联的数据库可以分开。</p>
</blockquote>
<h2 id="21-2-memrcached介绍"><a href="#21-2-memrcached介绍" class="headerlink" title="21.2 memrcached介绍"></a>21.2 memrcached介绍</h2><ul>
<li>Memcached是国外社区网站LiveJournal团队开发，目的是为了通过缓存数据库查询结果，减少数据库访问次数，从而提高动态web站点性能。</li>
<li>官方站点 <a href="http://www.memcached.org/" target="_blank" rel="noopener">http://www.memcached.org/</a></li>
<li>数据结构简单(k-v)，数据存放在内存里</li>
<li>多线程</li>
<li>基于c/s架构，协议简单</li>
<li>基于libevent的事件处理</li>
<li>自主内存存储处理（slab allowcation)</li>
<li>数据过期方式：Lazy Expiration 和 LRU</li>
</ul>
<h3 id="1-Memcached的数据流向"><a href="#1-Memcached的数据流向" class="headerlink" title="1. Memcached的数据流向"></a>1. Memcached的数据流向</h3><p>一般使用目的是，通过缓存数据库查询结果，减少数据库访问次数，以提高动态web应用的速度、提高可扩展性！</p>
<p><strong>正常的作业流程是</strong>：</p>
<p>用户发起请求给NGINX,然后再次调用PHP，PHP和mysql打交道，当用户PHP获取到请求转给NGINX，NGINX再次把请求数据交给用户。</p>
<p>如果并发量很大，请求mysql的队列比较多，这时候我们就需要增加一个缓存层Memcached。这样访问过的数据全部丢在缓存中，当再次请求这个数据的时候就直接从Memcached读取即可！</p>
<h3 id="2-Slab-allocation的原理"><a href="#2-Slab-allocation的原理" class="headerlink" title="2. Slab allocation的原理"></a>2. Slab allocation的原理</h3><ul>
<li>将分配的内存分割成各种尺寸的块（chunk）， 并把尺寸相同的块分成组（chunk的集合），每个chunk集合被称为slab。  </li>
<li>Memcached的内存分配以Page为单位，Page默认值为1M，可以在启动时通过-I参数来指定。 </li>
<li>Slab是由多个Page组成的，Page按照指定大小切割成多个chunk。 </li>
</ul>
<h3 id="3-Growth-factor"><a href="#3-Growth-factor" class="headerlink" title="3. Growth factor"></a>3. Growth factor</h3><ul>
<li>Memcached在启动时通过-f选项可以指定 Growth Factor因子。该值控制chunk大小的差异。默认值为1.25。</li>
<li>通过memcached-tool命令查看指定Memcached实例的不同slab状态，可以看到各Item所占大小（chunk大小）差距为1.25</li>
<li>命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># memcached-tool 127.0.0.1:11211 display</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="4-Memcached的数据过期方式"><a href="#4-Memcached的数据过期方式" class="headerlink" title="4. Memcached的数据过期方式"></a>4. Memcached的数据过期方式</h3><h4 id="4-1-Lazy-Expiration"><a href="#4-1-Lazy-Expiration" class="headerlink" title="4.1 Lazy Expiration"></a>4.1 Lazy Expiration</h4><ul>
<li>Memcached 内部不会监视记录是否过期，而是在get时查看记录的时间戳，检查记录是否过期。这种技术被称为lazy（惰性）expiration。因此，Memcached不会在过期监视上耗费CPU时间。</li>
</ul>
<h4 id="4-2-LRU"><a href="#4-2-LRU" class="headerlink" title="4.2 LRU *"></a>4.2 LRU *</h4><ul>
<li>Memcached会优先使用已超时的记录的空间，但即使如此，也会发生追加新记录时空间不足的情况，此时就要使用名为Least Recently Used（LRU）机制来分配空间。顾名思义，这是删除“最近最少使用”的记录的机制。因此，当内存空间不足时（无法从slab class获取到新的空间时），就从最近未被使用的记录中搜索，并将其空间分配给新的记录。从缓存的实用角度来看，该模型十分理想。</li>
</ul>
<h2 id="21-3-安装memcached"><a href="#21-3-安装memcached" class="headerlink" title="21.3 安装memcached"></a>21.3 安装memcached</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum install -y memcached libmemcached libevent</span><br><span class="line"></span><br><span class="line">systemctl start memcached</span><br><span class="line"></span><br><span class="line">[root@yt-06 ~]# netstat -lntp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address          Foreign Address        State      PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:11211          0.0.0.0:*              LISTEN      2899/memcached  </span><br><span class="line"></span><br><span class="line">[root@yt-06 ~]# ps aux | grep memcached</span><br><span class="line">memcach+  2899  0.0  0.1 325556  1180 ?        Ssl  22:02  0:00 /usr/bin/memcached -u memcached -p 11211 -m 64 -c 1024</span><br><span class="line"></span><br><span class="line"># /usr/bin/memcached -u memcached -p 11211 -m 64 -c 1024  //命令行启动+参数</span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# vim /etc/sysconfig/memcached     //memcached配置文件</span><br><span class="line">PORT=&quot;11211&quot;       //监听端口11211</span><br><span class="line">USER=&quot;memcached&quot;  //启动用户</span><br><span class="line">MAXCONN=&quot;1024&quot;  //最大并发数</span><br><span class="line">CACHESIZE=&quot;64&quot;   //可用内存，默认单位 M</span><br><span class="line">OPTIONS=&quot;&quot;     //可选选项，比如加上监听的ip，可以把OPTIONS=”” 改为OPTIONS=”127.0.0.1″</span><br></pre></td></tr></table></figure>

<h2 id="21-4-查看memcached状态"><a href="#21-4-查看memcached状态" class="headerlink" title="21.4 查看memcached状态"></a>21.4 查看memcached状态</h2><ul>
<li>memcached-tool 127.0.0.1:11211 stats</li>
<li>或者echo stats |nc 127.0.0.1 11211 需要安装nc工具 yum install -y nc</li>
<li>若安装libmemcached后，可以使用命令<br>  memstat –servers=127.0.0.1:11211 查看memcached服务状态</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# memcached-tool 127.0.0.1:11211 stats</span><br><span class="line">#127.0.0.1:11211 Field Value</span><br><span class="line">         accepting_conns 1</span><br><span class="line">               auth_cmds 0</span><br><span class="line">             auth_errors 0</span><br><span class="line">                   bytes 0</span><br><span class="line">              bytes_read 7</span><br><span class="line">           bytes_written 0</span><br><span class="line">              cas_badval 0</span><br><span class="line">                cas_hits 0</span><br><span class="line">              cas_misses 0</span><br><span class="line">               cmd_flush 0</span><br><span class="line">                 cmd_get 0</span><br><span class="line">                 cmd_set 0</span><br><span class="line">               cmd_touch 0</span><br><span class="line">             conn_yields 0</span><br><span class="line">   connection_structures 11</span><br><span class="line">   crawler_items_checked 0</span><br><span class="line">       crawler_reclaimed 0</span><br><span class="line">        curr_connections 10</span><br><span class="line">              curr_items 0</span><br><span class="line">               decr_hits 0</span><br><span class="line">             decr_misses 0</span><br><span class="line">             delete_hits 0</span><br><span class="line">           delete_misses 0</span><br><span class="line">       evicted_unfetched 0</span><br><span class="line">               evictions 0</span><br><span class="line">       expired_unfetched 0</span><br><span class="line">                get_hits 0</span><br><span class="line">              get_misses 0</span><br><span class="line">              hash_bytes 524288</span><br><span class="line">       hash_is_expanding 0</span><br><span class="line">        hash_power_level 16</span><br><span class="line">               incr_hits 0</span><br><span class="line">             incr_misses 0</span><br><span class="line">                libevent 2.0.21-stable</span><br><span class="line">          limit_maxbytes 67108864</span><br><span class="line">     listen_disabled_num 0</span><br><span class="line">       lrutail_reflocked 0</span><br><span class="line">            malloc_fails 0</span><br><span class="line">                     pid 13412</span><br><span class="line">            pointer_size 64</span><br><span class="line">               reclaimed 0</span><br><span class="line">            reserved_fds 20</span><br><span class="line">           rusage_system 0.003162</span><br><span class="line">             rusage_user 0.000924</span><br><span class="line">                 threads 4</span><br><span class="line">                    time 1522941651</span><br><span class="line">       total_connections 11</span><br><span class="line">             total_items 0</span><br><span class="line">              touch_hits 0</span><br><span class="line">            touch_misses 0</span><br><span class="line">                  uptime 25</span><br><span class="line">                 version 1.4.24</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">[root@yt-01 ~]# echo stats |nc 127.0.0.1 11211</span><br><span class="line">STAT pid 13412</span><br><span class="line">STAT uptime 169</span><br><span class="line">STAT time 1522941795</span><br><span class="line">STAT version 1.4.24</span><br><span class="line">STAT libevent 2.0.21-stable</span><br><span class="line">STAT pointer_size 64</span><br><span class="line">STAT rusage_user 0.001480</span><br><span class="line">STAT rusage_system 0.006246</span><br><span class="line">STAT curr_connections 10</span><br><span class="line">STAT total_connections 12</span><br><span class="line">STAT connection_structures 11</span><br><span class="line">STAT reserved_fds 20</span><br><span class="line">STAT cmd_get 0</span><br><span class="line">STAT cmd_set 0</span><br><span class="line">STAT cmd_flush 0</span><br><span class="line">STAT cmd_touch 0</span><br><span class="line">STAT get_hits 0</span><br><span class="line">STAT get_misses 0</span><br><span class="line">STAT delete_misses 0</span><br><span class="line">STAT delete_hits 0</span><br><span class="line">STAT incr_misses 0</span><br><span class="line">STAT incr_hits 0</span><br><span class="line">STAT decr_misses 0</span><br><span class="line">STAT decr_hits 0</span><br><span class="line">STAT cas_misses 0</span><br><span class="line">STAT cas_hits 0</span><br><span class="line">STAT cas_badval 0</span><br><span class="line">STAT touch_hits 0</span><br><span class="line">STAT touch_misses 0</span><br><span class="line">STAT auth_cmds 0</span><br><span class="line">STAT auth_errors 0</span><br><span class="line">STAT bytes_read 13</span><br><span class="line">STAT bytes_written 1127</span><br><span class="line">STAT limit_maxbytes 67108864</span><br><span class="line">STAT accepting_conns 1</span><br><span class="line">STAT listen_disabled_num 0</span><br><span class="line">STAT threads 4</span><br><span class="line">STAT conn_yields 0</span><br><span class="line">STAT hash_power_level 16</span><br><span class="line">STAT hash_bytes 524288</span><br><span class="line">STAT hash_is_expanding 0</span><br><span class="line">STAT malloc_fails 0</span><br><span class="line">STAT bytes 0</span><br><span class="line">STAT curr_items 0</span><br><span class="line">STAT total_items 0</span><br><span class="line">STAT expired_unfetched 0</span><br><span class="line">STAT evicted_unfetched 0</span><br><span class="line">STAT evictions 0</span><br><span class="line">STAT reclaimed 0</span><br><span class="line">STAT crawler_reclaimed 0</span><br><span class="line">STAT crawler_items_checked 0</span><br><span class="line">STAT lrutail_reflocked 0</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">[root@yt-01 ~]# memstat --servers=127.0.0.1:11211</span><br><span class="line">Server: 127.0.0.1 (11211)</span><br><span class="line">  pid: 13412</span><br><span class="line">  uptime: 193</span><br><span class="line">  time: 1522941819</span><br><span class="line">  version: 1.4.24</span><br><span class="line">  libevent: 2.0.21-stable</span><br><span class="line">  pointer_size: 64</span><br><span class="line">  rusage_user: 0.001480</span><br><span class="line">  rusage_system: 0.007460</span><br><span class="line">  curr_connections: 10</span><br><span class="line">  total_connections: 13</span><br><span class="line">  connection_structures: 11</span><br><span class="line">  reserved_fds: 20</span><br><span class="line">  cmd_get: 0</span><br><span class="line">  cmd_set: 0</span><br><span class="line">  cmd_flush: 0</span><br><span class="line">  cmd_touch: 0</span><br><span class="line">  get_hits: 0</span><br><span class="line">  get_misses: 0</span><br><span class="line">  delete_misses: 0</span><br><span class="line">  delete_hits: 0</span><br><span class="line">  incr_misses: 0</span><br><span class="line">  incr_hits: 0</span><br><span class="line">  decr_misses: 0</span><br><span class="line">  decr_hits: 0</span><br><span class="line">  cas_misses: 0</span><br><span class="line">  cas_hits: 0</span><br><span class="line">  cas_badval: 0</span><br><span class="line">  touch_hits: 0</span><br><span class="line">  touch_misses: 0</span><br><span class="line">  auth_cmds: 0</span><br><span class="line">  auth_errors: 0</span><br><span class="line">  bytes_read: 30</span><br><span class="line">  bytes_written: 2275</span><br><span class="line">  limit_maxbytes: 67108864</span><br><span class="line">  accepting_conns: 1</span><br><span class="line">  listen_disabled_num: 0</span><br><span class="line">  threads: 4</span><br><span class="line">  conn_yields: 0</span><br><span class="line">  hash_power_level: 16</span><br><span class="line">  hash_bytes: 524288</span><br><span class="line">  hash_is_expanding: 0</span><br><span class="line">  malloc_fails: 0</span><br><span class="line">  bytes: 0</span><br><span class="line">  curr_items: 0</span><br><span class="line">  total_items: 0</span><br><span class="line">  expired_unfetched: 0</span><br><span class="line">  evicted_unfetched: 0</span><br><span class="line">  evictions: 0</span><br><span class="line">  reclaimed: 0</span><br><span class="line">  crawler_reclaimed: 0</span><br><span class="line">  crawler_items_checked: 0</span><br><span class="line">  lrutail_reflocked: 0</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">[root@yt-01 ~]# telnet 127.0.0.1 11211</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is &apos;^]&apos;.</span><br><span class="line"></span><br><span class="line">stats</span><br><span class="line">STAT pid 22459                                进程ID</span><br><span class="line">STAT uptime 1027046                      服务器运行秒数</span><br><span class="line">STAT time 1273043062                    服务器当前unix时间戳</span><br><span class="line">STAT version 1.4.4                           服务器版本</span><br><span class="line">STAT libevent 2.0.21-stable</span><br><span class="line">STAT pointer_size 64                       操作系统字大小(这台服务器是64位的)</span><br><span class="line">STAT rusage_user 0.040000           进程累计用户时间</span><br><span class="line">STAT rusage_system 0.260000       进程累计系统时间</span><br><span class="line">STAT curr_connections 10               当前打开连接数</span><br><span class="line">STAT total_connections 82              曾打开的连接总数</span><br><span class="line">STAT connection_structures 13      服务器分配的连接结构数</span><br><span class="line">STAT reserved_fds 20</span><br><span class="line">STAT cmd_get 54                              执行get命令总数</span><br><span class="line">STAT cmd_set 34                              执行set命令总数</span><br><span class="line">STAT cmd_flush 3                              指向flush_all命令总数</span><br><span class="line">STAT get_hits 9                                  get命中次数</span><br><span class="line">STAT get_misses 45                          get未命中次数</span><br><span class="line">STAT delete_misses 5                      delete未命中次数</span><br><span class="line">STAT delete_hits 1                              delete命中次数</span><br><span class="line">STAT incr_misses 0                          incr未命中次数</span><br><span class="line">STAT incr_hits 0                          incr命中次数</span><br><span class="line">STAT decr_misses 0                  decr未命中次数</span><br><span class="line">STAT decr_hits 0                  decr命中次数</span><br><span class="line">STAT cas_misses 0                      cas未命中次数</span><br><span class="line">STAT cas_hits 0                      cas命中次数</span><br><span class="line">STAT cas_badval 0                      使用擦拭次数</span><br><span class="line">STAT touch_hits 0</span><br><span class="line">STAT touch_misses 0</span><br><span class="line">STAT auth_cmds 0</span><br><span class="line">STAT auth_errors 0</span><br><span class="line">STAT bytes_read 15785                      读取字节总数</span><br><span class="line">STAT bytes_written 15222                  写入字节总数</span><br><span class="line">STAT limit_maxbytes 67108864          分配的内存数（字节）</span><br><span class="line">STAT accepting_conns 1                  目前接受的链接数</span><br><span class="line">STAT listen_disabled_num 0</span><br><span class="line">STAT time_in_listen_disabled_us 0</span><br><span class="line">STAT threads 4                                      线程数</span><br><span class="line">STAT conn_yields 0</span><br><span class="line">STAT hash_power_level 16</span><br><span class="line">STAT hash_bytes 524288</span><br><span class="line">STAT hash_is_expanding 0</span><br><span class="line">STAT malloc_fails 0</span><br><span class="line">STAT conn_yields 0</span><br><span class="line">STAT bytes 0                                      存储item字节数</span><br><span class="line">STAT curr_items 0                                  item个数</span><br><span class="line">STAT total_items 34                             item总数</span><br><span class="line">STAT expired_unfetched 0</span><br><span class="line">STAT evicted_unfetched 0</span><br><span class="line">STAT evictions 0                                  为获取空间删除item的总数</span><br><span class="line">STAT reclaimed 0</span><br><span class="line">STAT crawler_reclaimed 0</span><br><span class="line">STAT crawler_items_checked 0</span><br><span class="line">STAT lrutail_reflocked 0</span><br><span class="line">END</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/21.5-21.8 memcached命令行、数据导出和导入、存储sessions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/21.5-21.8 memcached命令行、数据导出和导入、存储sessions/" itemprop="url">21.5-21.8 memcached命令行、数据导出和导入、存储sessions</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="21-5-memcached命令行"><a href="#21-5-memcached命令行" class="headerlink" title="21.5 memcached命令行"></a>21.5 memcached命令行</h1><p>Memcached类似于mysql一样，同样支持类似于mysql中创建一个库，创建一个表，插入一个表，查看表数据等。</p>
<h2 id="1-登录-Memcached"><a href="#1-登录-Memcached" class="headerlink" title="1 登录 Memcached"></a>1 登录 Memcached</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# telnet 127.0.0.1 11211   //测试端口</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is &apos;^]&apos;.</span><br><span class="line"># 进入memcached命令行</span><br><span class="line"></span><br><span class="line">stats     关于当前 memcached 实例的信息</span><br><span class="line">STAT pid 13412</span><br><span class="line">STAT uptime 1885</span><br><span class="line">STAT time 1522943511</span><br><span class="line">STAT version 1.4.24</span><br><span class="line">STAT libevent 2.0.21-stable</span><br><span class="line">STAT pointer_size 64</span><br><span class="line">STAT rusage_user 0.017423</span><br><span class="line">STAT rusage_system 0.046463</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set key2 0 30 2   //手动存储一个数据</span><br><span class="line"></span><br><span class="line">其中key2 代表着 key值</span><br><span class="line">0代表着 flags 标记</span><br><span class="line">30代表着 过期时间</span><br><span class="line">2代表着 2个字节</span><br><span class="line">---------------------------------------------</span><br><span class="line">set key2 0 30 2     //存储key2，标记为0，过期时间30s，2个字节的数据</span><br><span class="line">ab                          //输入数据，只能2个字节：ab</span><br><span class="line">STORED </span><br><span class="line">get key2               //获取key2数据（因为输入慢了，数据过期了）</span><br><span class="line">END</span><br><span class="line">set key2 0 30 2     //重新存</span><br><span class="line">ab</span><br><span class="line">STORED</span><br><span class="line">get key2               //获取成功</span><br><span class="line">VALUE key2 0 2</span><br><span class="line">ab</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<h2 id="2-Memcached语法规则"><a href="#2-Memcached语法规则" class="headerlink" title="2 Memcached语法规则"></a>2 Memcached语法规则</h2><ul>
<li><code>&lt;command name&gt; &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt;\r\n &lt;data block&gt;\r\n</code></li>
<li>注：\r\n在windows下是Enter键</li>
<li><code>&lt;command name&gt;</code>可以是set, add, replace</li>
<li>set表示按照相应的<code>&lt;key&gt;</code>存储该数据，没有的时候增加，有的时候覆盖</li>
<li>add表示按照相应的<code>&lt;key&gt;</code>添加该数据,但是如果该<code>&lt;key&gt;</code>已经存在则会操作失败</li>
<li>replace表示按照相应的<code>&lt;key&gt;</code>替换数据,但是如果该<code>&lt;key&gt;</code>不存在则操作失败。</li>
<li><code>&lt;key&gt;</code>客户端需要保存数据的key</li>
<li><code>&lt;flags&gt;</code>是一个16位的无符号的整数(以十进制的方式表示)。该标志将和需要存储的数据一起存储,并在客户端get数据时返回。客户端可以将此标志用做特殊用途，此标志对服务器来说是不透明的。</li>
<li><code>&lt;exptime&gt;</code> 为过期的时间。若为0表示存储的数据永远不过期(但可被服务器算法：LRU 等替换)。如果非0(unix时间或者距离此时的秒数),当过期后,服务器可以保证用户得不到该数据(以服务器时间为标准)。</li>
<li><code>&lt;bytes&gt;</code> 需要存储的字节数，当用户希望存储空数据时<code>&lt;bytes&gt;</code>可以为0</li>
<li><code>&lt;data block&gt;</code>需要存储的内容，输入完成后，最后客户端需要加上\r\n（直接点击Enter）作为结束标志。</li>
</ul>
<h2 id="3-Memcached数据示例"><a href="#3-Memcached数据示例" class="headerlink" title="3 Memcached数据示例"></a>3 Memcached数据示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">set key3 1 100 4         //存取一个4字节值</span><br><span class="line">abcd</span><br><span class="line">STORED</span><br><span class="line">get key3               //查询key3值</span><br><span class="line">VALUE key3 1 4</span><br><span class="line">abcd</span><br><span class="line">END</span><br><span class="line">replace key3 1 200 5         //替换key3的值</span><br><span class="line">abcdx</span><br><span class="line">STORED</span><br><span class="line">get key3                     //查询替换后的值</span><br><span class="line">VALUE key3 1 5       </span><br><span class="line">abcdx</span><br><span class="line">END</span><br><span class="line">delete key3    //删除key3的值</span><br><span class="line">DELETED</span><br><span class="line">get key3</span><br><span class="line">END</span><br><span class="line">quit           //退出</span><br><span class="line">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>

<h1 id="21-6-memcached数据导出和导入"><a href="#21-6-memcached数据导出和导入" class="headerlink" title="21.6 memcached数据导出和导入"></a>21.6 memcached数据导出和导入</h1><h2 id="1-导出"><a href="#1-导出" class="headerlink" title="1 导出"></a>1 导出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# date -d &quot;+1 hour&quot; +%s    //显示当前时间加一个小时时间戳</span><br><span class="line">1522948361</span><br><span class="line">[root@yt-01 ~]# memcached-tool 127.0.0.1:11211 dump &gt;data.txt      //导出</span><br><span class="line">Dumping memcache contents</span><br><span class="line">  Number of buckets: 1</span><br><span class="line">  Number of items : 4</span><br><span class="line">Dumping bucket 1 - 4 total items</span><br><span class="line">[root@yt-01 ~]# cat data.txt</span><br><span class="line">add key1 1 1522948361 3</span><br><span class="line">asd</span><br><span class="line">add name 1 1522948361 5</span><br><span class="line">justi</span><br><span class="line">add sex 1 1522948361 3</span><br><span class="line">man</span><br><span class="line">add age 1 1522948361 2</span><br><span class="line">27</span><br></pre></td></tr></table></figure>

<h2 id="2-导入"><a href="#2-导入" class="headerlink" title="2 导入"></a>2 导入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# nc 127.0.0.1 11211 &lt; data.txt</span><br><span class="line">若nc命令不存在，yum install nc</span><br></pre></td></tr></table></figure>

<p><strong>注意：导出的数据是带有一个时间戳的，这个时间戳就是该条数据过期的时间点，如果当前时间已经超过该时间戳，那么是导入不进去的。</strong><br>如果仅仅是为了测试，这样可以办到，因为memcached是缓存在内存中的，只要重启机器或者重启memcached服务缓存数据就会丢失，然后我们再次使用nc 导入就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# systemctl restart memcached</span><br><span class="line">[root@yt-01 ~]# nc 127.0.0.1 11211 &lt;data.txt</span><br><span class="line">STORED</span><br><span class="line">STORED</span><br><span class="line">STORED</span><br><span class="line">STORED</span><br></pre></td></tr></table></figure>

<h1 id="21-7-php连接memcached"><a href="#21-7-php连接memcached" class="headerlink" title="21.7 php连接memcached"></a>21.7 php连接memcached</h1><h2 id="1-先安装php的memcache扩展"><a href="#1-先安装php的memcache扩展" class="headerlink" title="1 先安装php的memcache扩展"></a>1 先安装php的memcache扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# cd /usr/local/src/</span><br><span class="line">[root@yt-01 src]# wget http://www.apelearn.com/bbs/data/attachment/forum/memcache-2.2.3.tgz </span><br><span class="line">[root@yt-01 src]# tar zxf memcache-2.2.3.tgz</span><br><span class="line">[root@yt-01 src]# cd memcache-2.2.3</span><br><span class="line">[root@yt-01 memcache-2.2.3]# ls</span><br><span class="line">config9.m4 config.w32 example.php memcache_consistent_hash.c memcache_queue.c memcache_session.c php_memcache.h</span><br><span class="line">config.m4 CREDITS memcache.c memcache.dsp memcache_queue.h memcache_standard_hash.c README</span><br><span class="line">[root@yt-01 memcache-2.2.3]# /usr/local/php/bin/phpize     //nginx的php目录是/usr/local/php-fpm/bin/phpize</span><br><span class="line">Configuring for:</span><br><span class="line">PHP Api Version: 20131106</span><br><span class="line">Zend Module Api No: 20131226</span><br><span class="line">Zend Extension Api No: 220131226</span><br><span class="line">[root@yt-01 memcache-2.2.3]# ./configure --with-php-config=/usr/local/php/bin/php-config</span><br><span class="line">[root@yt-01 memcache-2.2.3]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@yt-01 src]# make &amp; make install</span><br><span class="line"># 报错</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c: 在函数‘php_mmc_connect&apos;中:</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:1902: 错误：提供给函数‘zend_list_insert&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:1919: 错误：提供给函数‘zend_list_insert&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c: 在函数‘zif_memcache_add_server&apos;中:</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:1975: 错误：提供给函数‘zend_is_callable&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:2003: 错误：提供给函数‘zend_list_insert&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c: 在函数‘zif_memcache_set_server_params&apos;中:</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:2059: 错误：提供给函数‘zend_is_callable&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c: 在函数‘mmc_find_persistent&apos;中:</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:2159: 错误：提供给函数‘zend_list_insert&apos;的实参太少</span><br><span class="line">/usr/local/src/memcache-2.2.3/memcache.c:2177: 错误：提供给函数‘zend_list_insert&apos;的实参太少</span><br><span class="line">make: *** [memcache.lo] 错误 1</span><br><span class="line"></span><br><span class="line"># 解决方法</span><br><span class="line"># vim memcache.c</span><br><span class="line">将所有的：zend_list_insert(pool, le_memcache_pool);</span><br><span class="line">改为：zend_list_insert(pool, le_memcache_pool TSRMLS_CC);</span><br><span class="line">将所有的：zend_list_insert(mmc, le_pmemcache);</span><br><span class="line">改为：zend_list_insert(mmc, le_pmemcache TSRMLS_CC);</span><br><span class="line"></span><br><span class="line">讲所有的：if (!zend_is_callable(failure_callback, 0, NULL))</span><br><span class="line">改为：if (!zend_is_callable(failure_callback, 0, NULL, NULL))</span><br><span class="line"></span><br><span class="line">修改完成后，重新make编译；</span><br><span class="line"></span><br><span class="line">[root@yt-01 memcache-2.2.3]# make &amp; make install</span><br><span class="line">Installing shared extensions: /usr/local/php/lib/php/extensions/no-debug-zts-20131226/</span><br><span class="line">[root@yt-01 memcache-2.2.3]# ls /usr/local/php/lib/php/extensions/no-debug-zts-20131226/</span><br><span class="line">memcache.so opcache.so</span><br><span class="line"></span><br><span class="line">[root@yt-01 memcache-2.2.3]# vim /usr/local/php/etc/php.ini</span><br><span class="line">搜索extension，在extension模块行的最后加上： extension=&quot;memcache.so&quot;</span><br><span class="line">[root@yt-01 memcache-2.2.3]# /usr/local/php/bin/php -m</span><br><span class="line">有memcache 模块就可以了</span><br></pre></td></tr></table></figure>

<h2 id="2-测试"><a href="#2-测试" class="headerlink" title="2 测试"></a>2 测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 memcache-2.2.3]# vim 1.php  //编辑测试脚本</span><br><span class="line">&lt;?php</span><br><span class="line">//连接Memcache Memcache</span><br><span class="line">$mem = new Memcache;</span><br><span class="line">$mem-&gt;connect(&quot;localhost&quot;, 11211);</span><br><span class="line">//保存数据</span><br><span class="line">$mem-&gt;set(&apos;key1&apos;, &apos;This is first value&apos;, 0, 60);</span><br><span class="line">$val = $mem-&gt;get(&apos;key1&apos;);</span><br><span class="line">echo &quot;Get key1 value: &quot; . $val .&quot;&lt;br&gt;&quot;;</span><br><span class="line">//替换数据</span><br><span class="line">$mem-&gt;replace(&apos;key1&apos;, &apos;This is replace value&apos;, 0, 60);</span><br><span class="line">$val = $mem-&gt;get(&apos;key1&apos;);</span><br><span class="line">echo &quot;Get key1 value: &quot; . $val . &quot;&lt;br&gt;&quot;;</span><br><span class="line">//保存数组数据</span><br><span class="line">$arr = array(&apos;aaa&apos;, &apos;bbb&apos;, &apos;ccc&apos;, &apos;ddd&apos;);</span><br><span class="line">$mem-&gt;set(&apos;key2&apos;, $arr, 0, 60);</span><br><span class="line">$val2 = $mem-&gt;get(&apos;key2&apos;);</span><br><span class="line">echo &quot;Get key2 value: &quot;;</span><br><span class="line">print_r($val2);</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">//删除数据</span><br><span class="line">$mem-&gt;delete(&apos;key1&apos;);</span><br><span class="line">$val = $mem-&gt;get(&apos;key1&apos;);</span><br><span class="line">echo &quot;Get key1 value: &quot; . $val . &quot;&lt;br&gt;&quot;;</span><br><span class="line">//清除所有数据</span><br><span class="line">$mem-&gt;flush();</span><br><span class="line">$val2 = $mem-&gt;get(&apos;key2&apos;);</span><br><span class="line">echo &quot;Get key2 value: &quot;;</span><br><span class="line">print_r($val2);</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">//关闭连接</span><br><span class="line">$mem-&gt;close();</span><br><span class="line">?&gt;</span><br><span class="line"># 脚本意为： 连接memcache set一个数据， 保存 替换删除 关闭 等。</span><br><span class="line"></span><br><span class="line">[root@yt-01 memcache-2.2.3]# /usr/local/php/bin/php 1.php   //测试php脚本</span><br><span class="line">Get key1 value: This is first value&lt;br&gt;Get key1 value: This is replace value&lt;br&gt;Get key2 value: Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; aaa</span><br><span class="line">    [1] =&gt; bbb</span><br><span class="line">    [2] =&gt; ccc</span><br><span class="line">    [3] =&gt; ddd</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者，将1.php放到某个虚拟主机的根目录下，在浏览器测试</span><br><span class="line">显示如上内容就表示没问题</span><br></pre></td></tr></table></figure>

<h1 id="21-8-memcached中存储sessions"><a href="#21-8-memcached中存储sessions" class="headerlink" title="21.8 memcached中存储sessions"></a>21.8 memcached中存储sessions</h1><p>本节应用场景为LNMP架构下做的负载均衡。假如第一次登录是在A服务器上，第二次登录是在B服务器上，假如使用的是nginx代理upstream可以使用ip_hash；如果使用LVS呢？解决方法是：把session不存在服务器的磁盘上，而是存在memcached上去。memcached作为一个公共的服务器，任何web服务器都可以连接！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">本实例是在lamp/lnmp环境下实现</span><br><span class="line">编辑php.ini添加两行（待测试）</span><br><span class="line">session.save_handler = memcache</span><br><span class="line">session.save_path = &quot;tcp://192.168.0.9:11211&quot;</span><br><span class="line">或者httpd.conf中对应的虚拟主机中添加</span><br><span class="line">php_value session.save_handler &quot;memcache&quot;</span><br><span class="line">php_value session.save_path &quot;tcp://192.168.0.9:11211&quot;</span><br><span class="line">或者php-fpm.conf对应的pool中添加</span><br><span class="line">php_value[session.save_handler] = memcache</span><br><span class="line">php_value[session.save_path] = &quot;tcp://192.168.0.9:11211 &quot;</span><br></pre></td></tr></table></figure>

<h2 id="1-下载测试文件"><a href="#1-下载测试文件" class="headerlink" title="1 下载测试文件"></a>1 下载测试文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wget http://study.lishiming.net/.mem_se.txt</span><br><span class="line">将其移动到虚拟主机目录中：</span><br><span class="line">mv /root/.mem_se.txt /data/wwwroot/www.111.com</span><br><span class="line"></span><br><span class="line">cp .mem_se.txt 1.php</span><br><span class="line">在php-fpm.conf对应的pool中添加：</span><br><span class="line"></span><br><span class="line">vim /usr/local/php-fpm/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line">添加：</span><br><span class="line">php_value[session.save_handler] = memcache</span><br><span class="line">php_value[session.save_path] = &quot;tcp://192.168.122.130:11211&quot;</span><br><span class="line"></span><br><span class="line">注：如上要是有专门的memcache服务器，这儿就需要配置独立memcache的地址。</span><br><span class="line"></span><br><span class="line">/etc/init.d/php-fpm restart</span><br></pre></td></tr></table></figure>

<h2 id="2-测试-1"><a href="#2-测试-1" class="headerlink" title="2 测试"></a>2 测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 www.111.com]# curl localhost/1.php</span><br><span class="line">1507648188&lt;br&gt;&lt;br&gt;1507648188&lt;br&gt;&lt;br&gt;41026no8snqjq81phrl7ukovc6</span><br><span class="line">[root@yt-01 www.111.com]# curl localhost/1.php</span><br><span class="line">1507648268&lt;br&gt;&lt;br&gt;1507648268&lt;br&gt;&lt;br&gt;e2apbv2kkibntt4r59llfj52r1</span><br><span class="line">[root@yt-01 www.111.com]# curl localhost/1.php</span><br><span class="line">1507648269&lt;br&gt;&lt;br&gt;1507648269&lt;br&gt;&lt;br&gt;4mjm7v7thjldh413kuebcbjbe0</span><br><span class="line">[root@yt-01 www.111.com]# curl localhost/1.php</span><br><span class="line">1507648270&lt;br&gt;&lt;br&gt;1507648270&lt;br&gt;&lt;br&gt;1if2vpeut27r1siebjlv87ik92</span><br><span class="line">登录 查看值：</span><br><span class="line">[root@yt-01 www.111.com]# telnet 127.0.0.1 11211</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is &apos;^]&apos;.</span><br><span class="line">get i7vddchc2jdjpedsvck2tppra2</span><br><span class="line">VALUE i7vddchc2jdjpedsvck2tppra2 0 37</span><br><span class="line">TEST|i:1507648271;TEST3|i:1507648271;</span><br><span class="line">END</span><br><span class="line">如上使用get 去查看一个值！ 可以查询到相关的数据。</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/22.1-22.4 代码管理平台介绍和svn的安装和使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/22.1-22.4 代码管理平台介绍和svn的安装和使用/" itemprop="url">22.1-22.4 代码管理平台介绍和svn的安装和使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="22-1-代码管理平台介绍"><a href="#22-1-代码管理平台介绍" class="headerlink" title="22.1 代码管理平台介绍"></a>22.1 代码管理平台介绍</h1><h2 id="1-关于代码管理平台的常识"><a href="#1-关于代码管理平台的常识" class="headerlink" title="1.关于代码管理平台的常识"></a>1.关于代码管理平台的常识</h2><p>当大家谈论到代码管理平台的时候，会简单的把它认为就是一个放代码的地方，类似于FTP直接上传到指定位置就可以了。对于一个网站来说，这样理解没问题的。但是对于一个业务来说，每天都有很多代码需要不断的去更新，当然此过程不是想象的那么简单，上传即可，这个是需要开发组一点点去编辑（当然开发不是一个人去完成的是一个团队，不同的成员去编辑去修改，这个就是所谓的协同开发）。测试、（第一版，第二版，第三版……）合成，最后推送到指定的业务中去。 我们如果没有详细的工作日志，那么很难记得这些变更，代码管理平台就是一个帮助我们管理代码版本变更的一个工具。</p>
<ul>
<li>版本控制，记录若干文件内容变化，以便将来查阅特定版本修订情况</li>
<li>版本管理工具发展简史，cvs -&gt; svn -&gt; git        参考  <a href="http://luckypoem14.github.io/test/2012/04/24/scm-history/" target="_blank" rel="noopener">http://luckypoem14.github.io/test/2012/04/24/scm-history/</a></li>
<li>svn全称subversion，是一个开源版本控制系统，始于2000年</li>
<li>git是yt-01创始人linus发起的，2005年发布，最初目的是更好管理yt-01内核代码</li>
<li>git和svn不同在于git不需要依赖服务端就可以工作，即git是分布式的</li>
<li>github是基于git的在线web页面代码托管平台，可以选择付费服务</li>
<li>gitlab可以认为是一个开源的github，两者没有直接关系</li>
</ul>
<h2 id="2-svn和git的对比"><a href="#2-svn和git的对比" class="headerlink" title="2. svn和git的对比"></a>2. svn和git的对比</h2><p><strong>优点：</strong><br>1.对于某些项目的核心代码或者是一些重要的保密性要求较高的项目，svn比git更适合。<br>2.svn支持空目录<br>3.svn有更好的windows平台支持<br>4.svn可以check out/clone一个子树（sub-tree）<br>5.svn支持特权访问控制svn lock，在处理很难合并的文件时非常有用<br>6.svn支持二进制文件，更容易处理大文件（不需要把老版本拷来拷去）<br>7.学习简单、使用简单</p>
<p><strong>缺点：</strong><br>1.无网的情况下：无法提交代码，无法查看代码的历史版本、无法同步代码<br>2.代码要定期做备份（所有的代码数据及版本变更记录）<br>3.分支切换缓慢<br>4.由于每次提交都会保留一个原始副本，因此SVN的数据库容量会暴增。尤其是在开发人员非常多的情况下。</p>
<p>mark</p>
<h1 id="22-2-安装svn"><a href="#22-2-安装svn" class="headerlink" title="22.2 安装svn"></a>22.2 安装svn</h1><h2 id="服务端安装和配置SVN-yt-01"><a href="#服务端安装和配置SVN-yt-01" class="headerlink" title="服务端安装和配置SVN(yt-01)"></a>服务端安装和配置SVN(yt-01)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">安装</span><br><span class="line">[root@yt-01 ~]# yum install -y subversion</span><br><span class="line"></span><br><span class="line">创建版本库</span><br><span class="line">[root@yt-01 ~]# mkdir -p /data/svnroot/myproject</span><br><span class="line"></span><br><span class="line">版本库初始化</span><br><span class="line">root@yt-01 ~]# svnadmin create /data/svnroot/myproject</span><br><span class="line">[root@yt-01 ~]# ll /data/svnroot/myproject/</span><br><span class="line">总用量 8</span><br><span class="line">drwxr-xr-x 2 root root 54 4月 3 11:43 conf</span><br><span class="line">drwxr-sr-x 6 root root 233 4月 3 11:43 db</span><br><span class="line">-r--r--r-- 1 root root 2 4月 3 11:43 format</span><br><span class="line">drwxr-xr-x 2 root root 231 4月 3 11:43 hooks</span><br><span class="line">drwxr-xr-x 2 root root 41 4月 3 11:43 locks</span><br><span class="line">-rw-r--r-- 1 root root 229 4月 3 11:43 README.txt</span><br><span class="line"></span><br><span class="line">进入配置文件目录：</span><br><span class="line">[root@yt-01 ~]# cd /data/svnroot/myproject/conf/</span><br><span class="line">[root@yt-01 conf]# ls</span><br><span class="line">authz passwd svnserve.conf</span><br><span class="line">#authz：控制权限</span><br><span class="line">#passwd：密码文件</span><br><span class="line">#svnserve.conf：仓库配置文件</span><br><span class="line"></span><br><span class="line">配置用户及权限：</span><br><span class="line">[root@yt-01 conf]# vim authz</span><br><span class="line">[groups]</span><br><span class="line">admins = yuntai,user1</span><br><span class="line"># admin:组名</span><br><span class="line"># yuntai，user1：两个用户</span><br><span class="line">[/]                    // [/]:指定目录，“/”代表仓库的根目录，即/data/svnroot/myproject/</span><br><span class="line">@admins = rw   //指定admins组所对应的权限</span><br><span class="line">* = r                 //指定其他所有用户对应的权限</span><br><span class="line">[myproject:/] </span><br><span class="line"># myproject：项目名称，该方法适合SVN有多个项目（或有多个子项目）时使用</span><br><span class="line">user1 = rw</span><br><span class="line"></span><br><span class="line">配置用户密码：</span><br><span class="line">[root@yt-01 conf]# vim passwd</span><br><span class="line">[users]</span><br><span class="line">yuntai = 123456</span><br><span class="line">user1 = 123456</span><br><span class="line">#为了提高安全性，真是环境要设置复杂密码</span><br><span class="line"></span><br><span class="line">配置仓库文件：</span><br><span class="line">[root@yt-01 conf]# vim svnserve.conf</span><br><span class="line">[general]</span><br><span class="line">anon-access = none  </span><br><span class="line">#指定匿名用户权限</span><br><span class="line"></span><br><span class="line">auth-access = write  </span><br><span class="line">#指定认证用户权限</span><br><span class="line"></span><br><span class="line">password-db = passwd</span><br><span class="line">#指定用户密码文件</span><br><span class="line"></span><br><span class="line">authz-db = authz</span><br><span class="line">#指定用户权限文件</span><br><span class="line"></span><br><span class="line">realm = /data/svnroot/myproject</span><br><span class="line">#指定对用的仓库文件（绝对路径）</span><br><span class="line"></span><br><span class="line">启动SVN：</span><br><span class="line">[root@yt-01 conf]# svnserve -d -r /data/svnroot/</span><br><span class="line"># -d：表示后台运行</span><br><span class="line"># -r：=restrict（限制、约束）限制只输出指定路径下的版本库</span><br><span class="line"></span><br><span class="line">查看进程及端口：</span><br><span class="line">[root@yt-01 conf]# ps aux |grep svn</span><br><span class="line">root 2543 0.0 0.1 162188 656 ? Ss 19:30 0:00 svnserve -d -r /data/svnroot/</span><br><span class="line">[root@yt-01 conf]# netstat -lntp |grep svn</span><br><span class="line">tcp 0 0 0.0.0.0:3690 0.0.0.0:* LISTEN 2543/svnserve</span><br></pre></td></tr></table></figure>

<h1 id="22-3-客户端上使用svn（yt-02）"><a href="#22-3-客户端上使用svn（yt-02）" class="headerlink" title="22.3 客户端上使用svn（yt-02）"></a>22.3 客户端上使用svn（yt-02）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">安装：</span><br><span class="line">[root@yt-02 ~]# yum install -y subversion</span><br><span class="line"></span><br><span class="line">进入测试目录：</span><br><span class="line">[root@yt-02 ~]# mkdir -p /home/svntest/</span><br><span class="line">[root@yt-02 ~]# cd !$</span><br><span class="line">cd /home/svntest/</span><br><span class="line"></span><br><span class="line">取出代码（从客户端1）：</span><br><span class="line">[root@yt-02 svntest]# svn checkout svn://192.168.122.130/myproject --username=yuntai</span><br><span class="line"></span><br><span class="line">认证领域: &lt;svn://192.168.122.130:3690&gt; /data/svnroot/myproject</span><br><span class="line">“yuntai”的密码:</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">注意! 你的密码，对于认证域:</span><br><span class="line">   &lt;svn://192.168.122.130:3690&gt; /data/svnroot/myproject</span><br><span class="line">只能明文保存在磁盘上! 如果可能的话，请考虑配置你的系统，让 Subversion</span><br><span class="line">可以保存加密后的密码。请参阅文档以获得详细信息。</span><br><span class="line">你可以通过在“/root/.subversion/servers”中设置选项“store-plaintext-passwords”为“yes”或“no”，</span><br><span class="line">来避免再次出现此警告。</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">保存未加密的密码(yes/no)?n</span><br><span class="line">取出版本 0。</span><br><span class="line"></span><br><span class="line">[root@yt-02 svntest]# ls</span><br><span class="line">myproject</span><br><span class="line">[root@yt-02 svntest]# ls myproject/</span><br><span class="line">[root@yt-02 svntest]# ls -a</span><br><span class="line">. .. myproject</span><br><span class="line">[root@yt-02 svntest]# ls -a myproject/</span><br><span class="line">. .. .svn</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">客户端1项目中增加一份文件</span><br><span class="line">[root@yt-02 svntest]# cd myproject/</span><br><span class="line">[root@yt-02 myproject]# ls</span><br><span class="line">[root@yt-02 myproject]# cp /etc/fstab ./       </span><br><span class="line">[root@yt-02 myproject]# ls</span><br><span class="line">fstab</span><br><span class="line"></span><br><span class="line">客户端1上传本地文件到服务端：</span><br><span class="line">[root@yt-02 myproject]# svn add ./fstab     //打上标记</span><br><span class="line">A                  fstab</span><br><span class="line">[root@yt-02 myproject]# svn commit -m &quot;add fstab&quot;     //正式上传，提交项目， -m：=mark，做标记</span><br><span class="line">正在增加 fstab</span><br><span class="line">传输文件数据.</span><br><span class="line">提交后的版本为 1。</span><br><span class="line"></span><br><span class="line">在服务端使用user1作为用户登录，作为客户端2，取出服务端项目文件</span><br><span class="line">[root@yt-01 myproject]# mkdir /home/svntest2/</span><br><span class="line">[root@yt-01 myprojec]# cd !$</span><br><span class="line">cd /home/svntest2/</span><br><span class="line">[root@yt-01 svntest2]# svn checkout svn://192.168.122.130/myproject --username=user1</span><br><span class="line">A myproject/fstab</span><br><span class="line">取出版本 1。</span><br><span class="line">[root@yt-01 svntest2]# ls</span><br><span class="line">myproject</span><br><span class="line">[root@yt-01 svntest2]# cd myproject/</span><br><span class="line">[root@yt-01 myproject]# ls</span><br><span class="line">fstab</span><br><span class="line"># 此时，在客户端1中提交的文件被同步到客户端2中</span><br><span class="line"># 再次上传新文件后可以使用命令：svn update进行同步</span><br><span class="line"></span><br><span class="line">客户端1：</span><br><span class="line">[root@yt-02 myproject]# vim test.txt</span><br><span class="line">[root@yt-02 myproject]# ls</span><br><span class="line">fstab test.txt</span><br><span class="line">[root@yt-02 myproject]# svn add ./test.txt</span><br><span class="line">A test.txt</span><br><span class="line">[root@yt-02 myproject]# svn commit -m &quot;add test.txt&quot;</span><br><span class="line">正在增加 test.txt</span><br><span class="line">传输文件数据.</span><br><span class="line">提交后的版本为 2。</span><br><span class="line"></span><br><span class="line">客户端2：</span><br><span class="line">[root@yt-01 myproject]# ls</span><br><span class="line">fstab</span><br><span class="line">[root@yt-01 myproject]# svn update</span><br><span class="line">正在升级 &apos;.&apos;:</span><br><span class="line">已还原“test.txt”</span><br><span class="line">版本 2。</span><br><span class="line">[root@yt-01 myproject]# ls</span><br><span class="line">fstab test.txt</span><br><span class="line">#注：此处update可以简写为up</span><br><span class="line"></span><br><span class="line">客户端密码文件保存位置：</span><br><span class="line">[root@yt-02 myproject]# cd /root/.subversion/auth/svn.simple</span><br><span class="line">[root@yt-02 svn.simple]# ls</span><br><span class="line">60b825fc1cf60a306eb7e67ad30c922d</span><br><span class="line">[root@yt-02 svn.simple]# cat 60b825fc1cf60a306eb7e67ad30c922d</span><br><span class="line">K 8</span><br><span class="line">passtype</span><br><span class="line">V 6</span><br><span class="line">simple</span><br><span class="line">K 8</span><br><span class="line">password</span><br><span class="line">V 6</span><br><span class="line">123456</span><br><span class="line">K 15</span><br><span class="line">svn:realmstring</span><br><span class="line">V 52</span><br><span class="line">&lt;svn://192.168.122.130:3690&gt; /data/svnroot/myproject</span><br><span class="line">K 8</span><br><span class="line">username</span><br><span class="line">V 6</span><br><span class="line">yuntai</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"># 如果在某客户端删除该文件，再次使用svn update进行同步时会提示输入root用户名和密码</span><br><span class="line"># 在此，直接回车，然后输入svn指定的用户和密码即可</span><br></pre></td></tr></table></figure>

<h2 id="SVN命令总结"><a href="#SVN命令总结" class="headerlink" title="SVN命令总结"></a>SVN命令总结</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># svn delete filename //在本地删除</span><br><span class="line"></span><br><span class="line"># svn commit -m “delete filename” //在服务器上删除</span><br><span class="line"></span><br><span class="line"># svn update //把当前目录下的文件都更新到最新版</span><br><span class="line"></span><br><span class="line"># svn log //查看变更日志</span><br><span class="line"></span><br><span class="line"># svn add . //添加到版本控制中心</span><br><span class="line"></span><br><span class="line"># svn commit -m “add file” //把文件上传到服务器</span><br><span class="line"></span><br><span class="line"># svn checkout svn://192.168.133.130/myproject --username=yuntai</span><br></pre></td></tr></table></figure>

<h1 id="22-4-客户端上使用svn（windows）"><a href="#22-4-客户端上使用svn（windows）" class="headerlink" title="22.4 客户端上使用svn（windows）"></a>22.4 客户端上使用svn（windows）</h1><ul>
<li>官网 <a href="https://tortoisesvn.net/index.zh.html" target="_blank" rel="noopener">https://tortoisesvn.net/index.zh.html</a></li>
<li>下载TortoiseSVN 并安装</li>
<li>简明教程 <a href="http://www.jianshu.com/p/6b3b7b915332" target="_blank" rel="noopener">http://www.jianshu.com/p/6b3b7b915332</a></li>
</ul>
<h1 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h1><h2 id="svn-多仓库管理-http-elim-iteye-com-blog-1171108"><a href="#svn-多仓库管理-http-elim-iteye-com-blog-1171108" class="headerlink" title="svn 多仓库管理 http://elim.iteye.com/blog/1171108"></a>svn 多仓库管理 <a href="http://elim.iteye.com/blog/1171108" target="_blank" rel="noopener">http://elim.iteye.com/blog/1171108</a></h2><h2 id="svn-ssh-http-www-linuxfly-org-post-450"><a href="#svn-ssh-http-www-linuxfly-org-post-450" class="headerlink" title="svn+ssh http://www.linuxfly.org/post/450/"></a>svn+ssh <a href="http://www.linuxfly.org/post/450/" target="_blank" rel="noopener">http://www.linuxfly.org/post/450/</a></h2><h2 id="svn清除保存的用户名和密码-http-holy2010-blog-51cto-com-1086044-645944"><a href="#svn清除保存的用户名和密码-http-holy2010-blog-51cto-com-1086044-645944" class="headerlink" title="svn清除保存的用户名和密码 http://holy2010.blog.51cto.com/1086044/645944"></a>svn清除保存的用户名和密码 <a href="http://holy2010.blog.51cto.com/1086044/645944" target="_blank" rel="noopener">http://holy2010.blog.51cto.com/1086044/645944</a></h2><h2 id="svn命令详解-http-blog-sina-com-cn-s-blog-963453200101eiuq-html"><a href="#svn命令详解-http-blog-sina-com-cn-s-blog-963453200101eiuq-html" class="headerlink" title="svn命令详解 http://blog.sina.com.cn/s/blog_963453200101eiuq.html"></a>svn命令详解 <a href="http://blog.sina.com.cn/s/blog_963453200101eiuq.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_963453200101eiuq.html</a></h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/22.5-22.8 单机上使用git、建立远程仓库、克隆远程仓库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/22.5-22.8 单机上使用git、建立远程仓库、克隆远程仓库/" itemprop="url">22.5-22.8 单机上使用git、建立远程仓库、克隆远程仓库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="22-5-22-6-单机上使用git"><a href="#22-5-22-6-单机上使用git" class="headerlink" title="22.5/22.6 单机上使用git"></a>22.5/22.6 单机上使用git</h1><h2 id="1-准备"><a href="#1-准备" class="headerlink" title="1 准备"></a>1 准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">安装git</span><br><span class="line">[root@yt-01 /]# yum install -y git</span><br><span class="line"></span><br><span class="line">建立git版本库目录</span><br><span class="line">[root@yt-01 /]# mkdir /data/gitroot/</span><br><span class="line"></span><br><span class="line">初始化gi版本仓库</span><br><span class="line">[root@yt-01 /]# cd /data/gitroot/</span><br><span class="line">[root@yt-01 gitroot]# git init</span><br><span class="line">初始化空的 Git 版本库于 /data/gitroot/.git/</span><br><span class="line"></span><br><span class="line">配置用户名和邮箱</span><br><span class="line">[root@yt-01 gitroot]# git config --global user.email &quot;zhouqunic@163.com&quot;</span><br><span class="line">[root@yt-01 gitroot]# git config --global user.name &quot;yuntai&quot;</span><br><span class="line"></span><br><span class="line">配置文件</span><br><span class="line">[root@yt-01 gitroot]# cat /root/.gitconfig</span><br><span class="line">[user]</span><br><span class="line"> email = zhouqunic@163.com</span><br><span class="line"> name = yuntai</span><br></pre></td></tr></table></figure>

<h1 id="2-上传，对比和查看状态"><a href="#2-上传，对比和查看状态" class="headerlink" title="2. 上传，对比和查看状态"></a>2. 上传，对比和查看状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">创建新文件</span><br><span class="line">[root@yt-01 gitroot]# echo -e &quot;123/234/456/789&quot; &gt; 1.txt</span><br><span class="line">[root@yt-01 gitroot]# ll</span><br><span class="line">总用量 4</span><br><span class="line">-rw-r--r-- 1 root root 16 4月 3 14:39 1.txt</span><br><span class="line"></span><br><span class="line">把1.txt添加到git仓库</span><br><span class="line">[root@yt-01 gitroot]# git add 1.txt         //打标记</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;creat new file 1.txt&quot;   //上传</span><br><span class="line">[master（根提交） 44609a5] creat new file 1.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 1.txt</span><br><span class="line"># 记住，上传文件到仓库，每次都要 git add filename 和 git commit -m &quot;注释&quot; 两句命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">再次变更1.txt</span><br><span class="line">[root@yt-01 gitroot]# echo -e &quot;1 new added/END&quot; &gt;&gt; 1.txt</span><br><span class="line">[root@yt-01 gitroot]# cat 1.txt</span><br><span class="line">123/234/456/789</span><br><span class="line">1 new added/END</span><br><span class="line"></span><br><span class="line">查看当前仓库中的状态，比如是否有改动的文件</span><br><span class="line">[root@yt-01 gitroot]# git status</span><br><span class="line"># 位于分支 master</span><br><span class="line"># 尚未暂存以备提交的变更：</span><br><span class="line"># （使用 &quot;git add &lt;file&gt;...&quot; 更新要提交的内容）</span><br><span class="line"># （使用 &quot;git checkout -- &lt;file&gt;...&quot; 丢弃工作区的改动）</span><br><span class="line">#</span><br><span class="line">#	修改： 1.txt</span><br><span class="line">#</span><br><span class="line">修改尚未加入提交（使用 &quot;git add&quot; 和/或 &quot;git commit -a&quot;）</span><br><span class="line"></span><br><span class="line"># 每部操作之后都可以使用“git status”查看当前状态，可以根据提示信息进行后续操作。</span><br><span class="line"></span><br><span class="line">不同版本文件对比</span><br><span class="line">[root@yt-01 gitroot]# git diff 1.txt</span><br><span class="line">diff --git a/1.txt b/1.txt</span><br><span class="line">index a53950c..49384d8 100644</span><br><span class="line">--- a/1.txt</span><br><span class="line">+++ b/1.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> 123/234/456/789</span><br><span class="line">+1 new added/END</span><br></pre></td></tr></table></figure>

<h2 id="3-版本变更"><a href="#3-版本变更" class="headerlink" title="3 版本变更"></a>3 版本变更</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">更新版本</span><br><span class="line">[root@yt-01 gitroot]# git add 1.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;add 1.txt again&quot;</span><br><span class="line">[master 01803b5] add 1.txt again</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">查看版本变更日志</span><br><span class="line">[root@yt-01 gitroot]# git log</span><br><span class="line">commit 01803b54e07b9842da0c2c4558fdafd66b05ada6</span><br><span class="line">Author: yuntai &lt;zhouqunic@163.com&gt;</span><br><span class="line">Date: Tue Apr 3 15:04:36 2018 +0800</span><br><span class="line">    add 1.txt again</span><br><span class="line">commit 2ab6b801dd207ef35d102c240173dc69d2ff3dc2</span><br><span class="line">Author: yuntai &lt;zhouqunic@163.com&gt;</span><br><span class="line">Date: Tue Apr 3 15:02:00 2018 +0800</span><br><span class="line">    add 1.txt again</span><br><span class="line">commit 44609a553eef00abe45e45a3c1bd54cc8fe9a402</span><br><span class="line">Author: yuntai &lt;zhouqunic@163.com&gt;</span><br><span class="line">Date: Tue Apr 3 14:41:50 2018 +0800</span><br><span class="line">    creat new file 1.txt</span><br><span class="line"></span><br><span class="line">删除文件2行，并更新版本</span><br><span class="line">[root@yt-01 gitroot]# vim 1.txt</span><br><span class="line">[root@yt-01 gitroot]# git add 1.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;删除最后2行 &quot;</span><br><span class="line">[master 5acf95f] 删除最后2行</span><br><span class="line"> 1 file changed, 2 deletions(-)</span><br><span class="line"></span><br><span class="line">版本变更日志，一行显示</span><br><span class="line">[root@yt-01 gitroot]# git log --pretty=oneline   //版本变更日志，一行显示</span><br><span class="line">5acf95fd5e06f1fc01acc0f28f5753610a292a07 删除最后2行</span><br><span class="line">01803b54e07b9842da0c2c4558fdafd66b05ada6 add 1.txt again</span><br><span class="line">2ab6b801dd207ef35d102c240173dc69d2ff3dc2 add 1.txt again</span><br><span class="line">44609a553eef00abe45e45a3c1bd54cc8fe9a402 creat new file 1.txt</span><br><span class="line"># 代码表示版本代码</span><br><span class="line"></span><br><span class="line">版本回退</span><br><span class="line">[root@yt-01 gitroot]# git reset --hard 2ab6b801dd207</span><br><span class="line">HEAD 现在位于 2ab6b80 add 1.txt again</span><br><span class="line"># hard后面跟的代码可以只填写一部分</span><br><span class="line">[root@yt-01 gitroot]# git log --pretty=oneline</span><br><span class="line">2ab6b801dd207ef35d102c240173dc69d2ff3dc2 add 1.txt again</span><br><span class="line">44609a553eef00abe45e45a3c1bd54cc8fe9a402 creat new file 1.txt</span><br><span class="line"></span><br><span class="line">撤销版本回退（假如忘了版本代码）</span><br><span class="line">[root@yt-01 gitroot]# git reflog        //查看所有历史版本</span><br><span class="line">2ab6b80 HEAD@&#123;0&#125;: reset: moving to 2ab6b801dd207</span><br><span class="line">5acf95f HEAD@&#123;1&#125;: commit: 删除最后2行</span><br><span class="line">01803b5 HEAD@&#123;2&#125;: commit: add 1.txt again</span><br><span class="line">2ab6b80 HEAD@&#123;3&#125;: commit: add 1.txt again</span><br><span class="line">44609a5 HEAD@&#123;4&#125;: commit (initial): creat new file 1.txt</span><br><span class="line"># 版本回退</span><br><span class="line">[root@yt-01 gitroot]# git log --pretty=oneline</span><br><span class="line">5acf95fd5e06f1fc01acc0f28f5753610a292a07 删除最后2行</span><br><span class="line">01803b54e07b9842da0c2c4558fdafd66b05ada6 add 1.txt again</span><br><span class="line">2ab6b801dd207ef35d102c240173dc69d2ff3dc2 add 1.txt again</span><br><span class="line">44609a553eef00abe45e45a3c1bd54cc8fe9a402 creat new file 1.txt</span><br><span class="line"></span><br><span class="line">假如文件1.txt被删除了</span><br><span class="line">[root@yt-01 gitroot]# rm -rf 1.txt</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">[root@yt-01 gitroot]# git checkout -- 1.txt    //恢复原来文件</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt</span><br><span class="line"></span><br><span class="line">假如更改了1.txt，然后git add了，但是没有git commit，不想更新了，想回退到当时版本</span><br><span class="line">[root@yt-01 gitroot]# echo -e &quot;xxxxxx&quot; &gt; 1.txt</span><br><span class="line">[root@yt-01 gitroot]# git add 1.txt</span><br><span class="line">[root@yt-01 gitroot]# git reset HEAD 1.txt   //重置缓存</span><br><span class="line">重置后撤出暂存区的变更：</span><br><span class="line">M	1.txt</span><br><span class="line">[root@yt-01 gitroot]# cat 1.txt</span><br><span class="line">xxxxxx</span><br><span class="line">[root@yt-01 gitroot]# git checkout -- 1.txt     //恢复原来文件</span><br><span class="line">[root@yt-01 gitroot]# cat 1.txt</span><br><span class="line">123/234/456/789</span><br></pre></td></tr></table></figure>

<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gitroot]# git rm 1.txt    //删除文件</span><br><span class="line">rm &apos;1.txt&apos;</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;删除1.txt文件&quot;     //提交删除</span><br><span class="line">[master 7215021] 删除1.txt文件</span><br><span class="line"> 1 file changed, 1 deletion(-)</span><br><span class="line"> delete mode 100644 1.txt</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line"></span><br><span class="line">git checkout已经不能恢复了</span><br><span class="line">[root@yt-01 gitroot]# git checkout -- 1.txt</span><br><span class="line">error: pathspec &apos;1.txt&apos; did not match any file(s) known to git.</span><br><span class="line"></span><br><span class="line">恢复git rm删除的文件</span><br><span class="line">[root@yt-01 gitroot]# git log --pretty=oneline     //查看版本日志</span><br><span class="line">721502178db58654977d89635423afaa806e3c27 删除1.txt文件</span><br><span class="line">5acf95fd5e06f1fc01acc0f28f5753610a292a07 删除最后2行</span><br><span class="line">01803b54e07b9842da0c2c4558fdafd66b05ada6 add 1.txt again</span><br><span class="line">2ab6b801dd207ef35d102c240173dc69d2ff3dc2 add 1.txt again</span><br><span class="line">44609a553eef00abe45e45a3c1bd54cc8fe9a402 creat new file 1.txt</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git reset --hard 721502178d     //最后的版本已经是删除掉的时候，恢复不了</span><br><span class="line">HEAD 现在位于 7215021 删除1.txt文件</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">[root@yt-01 gitroot]# git reset --hard 5acf95fd5e06f1fc01acc0f28f5753610a292a07    //回退到对应版本才可以</span><br><span class="line">HEAD 现在位于 5acf95f 删除最后2行</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt</span><br></pre></td></tr></table></figure>

<h1 id="22-7-建立远程仓库"><a href="#22-7-建立远程仓库" class="headerlink" title="22.7 建立远程仓库"></a>22.7 建立远程仓库</h1><h2 id="1-创建远程仓库"><a href="#1-创建远程仓库" class="headerlink" title="1 创建远程仓库"></a>1 创建远程仓库</h2><p>GitHub官网：github.com<br>注册账号并激活，然后开始创建主机的仓库！<br>创建完成后，添加key：<br>点击浏览器右上角头像——setting——SSH and GPG keys（选择SSH keys）——在服务器（虚拟机）执行ssh-keygen命令生成密钥对（/root/.ssh/id_rsa-私钥， /root/.ssh/id_rsa.pub-公钥）——将公钥复制到浏览器后点“添加”。</p>
<h2 id="2-创建同名本地仓库，并连接"><a href="#2-创建同名本地仓库，并连接" class="headerlink" title="2 创建同名本地仓库，并连接"></a>2 创建同名本地仓库，并连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">创建本地版本仓库</span><br><span class="line">[root@yt-01 tmp]# mkdir /tmp/gittest/</span><br><span class="line">[root@yt-01 tmp]# cd gittest/</span><br><span class="line">[root@yt-01 tmp]# echo &quot;# gittest&quot; &gt;&gt; README.md</span><br><span class="line">[root@yt-01 gittest]# git add README.md    </span><br><span class="line">[root@yt-01 gittest]# git commit -m &quot;创建README.md&quot;</span><br><span class="line">[master（根提交） f7045bf] 创建README.md</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">远程连接</span><br><span class="line">[root@yt-01 gittest]# git remote add origin git@github.com:zhouqunic/gittest.git</span><br><span class="line">[root@yt-01 gittest]# git push -u origin master</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 232 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line"> * [new branch] master -&gt; master</span><br><span class="line">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br></pre></td></tr></table></figure>

<h2 id="3-文件推送"><a href="#3-文件推送" class="headerlink" title="3 文件推送"></a>3 文件推送</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">新建文件</span><br><span class="line">[root@yt-01 gittest]# vim 123.txt</span><br><span class="line">[root@yt-01 gittest]# cat 123.txt</span><br><span class="line">123 123 123</span><br><span class="line">123 123</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">推送到本地仓库</span><br><span class="line">[root@yt-01 gittest]# git add 123.txt</span><br><span class="line">[root@yt-01 gittest]# git commit -m &quot;新建123.txt文件&quot;</span><br><span class="line">[master 6007c36] 新建123.txt文件</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br><span class="line"> create mode 100644 123.txt</span><br><span class="line"></span><br><span class="line">推送到远程仓库</span><br><span class="line">[root@yt-01 gittest]# git push</span><br><span class="line">warning: push.default 未设置，它的默认值将会在 Git 2.0 由 &apos;matching&apos;</span><br><span class="line">修改为 &apos;simple&apos;。若要不再显示本信息并在其默认值改变后维持当前使用习惯，</span><br><span class="line">进行如下设置：</span><br><span class="line">  git config --global push.default matching</span><br><span class="line">若要不再显示本信息并从现在开始采用新的使用习惯，设置：</span><br><span class="line">  git config --global push.default simple</span><br><span class="line">参见 &apos;git help config&apos; 并查找 &apos;push.default&apos; 以获取更多信息。</span><br><span class="line">（&apos;simple&apos; 模式由 Git 1.7.11 版本引入。如果您有时要使用老版本的 Git，</span><br><span class="line">为保持兼容，请用 &apos;current&apos; 代替 &apos;simple&apos; 模式）</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 300 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line">   f7045bf..6007c36 master -&gt; master</span><br><span class="line"></span><br><span class="line"># 上面有好多无用的提示信息，为了之后不显示这些信息，根据提示执行命令</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git config --global push.default simple</span><br></pre></td></tr></table></figure>

<h1 id="22-8-克隆远程仓库"><a href="#22-8-克隆远程仓库" class="headerlink" title="22.8 克隆远程仓库"></a>22.8 克隆远程仓库</h1><h2 id="克隆远程仓库"><a href="#克隆远程仓库" class="headerlink" title="克隆远程仓库"></a>克隆远程仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">创建一个本地文件夹，来放克隆的内容</span><br><span class="line">[root@yt-01 gittest]# cd /usr/local/sbin/</span><br><span class="line">[root@yt-01 sbin]# ls</span><br><span class="line"></span><br><span class="line">克隆远程仓库</span><br><span class="line">[root@yt-01 sbin]# git clone https://github.com/maicong/LNMP.git     //克隆</span><br><span class="line">正克隆到 &apos;LNMP&apos;...</span><br><span class="line">remote: Counting objects: 420, done.</span><br><span class="line">remote: Total 420 (delta 0), reused 0 (delta 0), pack-reused 420</span><br><span class="line">接收对象中: 100% (420/420), 612.72 KiB | 95.00 KiB/s, done.</span><br><span class="line">处理 delta 中: 100% (224/224), done.</span><br><span class="line">[root@yt-01 sbin]# ls</span><br><span class="line">LNMP</span><br><span class="line">[root@yt-01 sbin]# cd LNMP/</span><br><span class="line">[root@yt-01 LNMP]# ls</span><br><span class="line">DBMGT etc home keys LICENSE lnmp.sh README.md source.sh svnserve svn.sh</span><br></pre></td></tr></table></figure>

<h2 id="编辑仓库"><a href="#编辑仓库" class="headerlink" title="编辑仓库"></a>编辑仓库</h2><p>要是自己的仓库，别人的仓库的话，必须fork到自己的仓库，克隆后才能编辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 sbin]# git clone git@github.com:zhouqunic/LNMP.git</span><br><span class="line">正克隆到 &apos;LNMP&apos;...</span><br><span class="line">remote: Counting objects: 420, done.</span><br><span class="line">remote: Total 420 (delta 0), reused 0 (delta 0), pack-reused 420</span><br><span class="line">接收对象中: 100% (420/420), 612.72 KiB | 62.00 KiB/s, done.</span><br><span class="line">处理 delta 中: 100% (224/224), done.</span><br><span class="line">[root@yt-01 sbin]# ls</span><br><span class="line">LNMP</span><br><span class="line">[root@yt-01 sbin]# cd LNMP/</span><br><span class="line">[root@yt-01 LNMP]# ls</span><br><span class="line">DBMGT etc home keys LICENSE lnmp.sh README.md source.sh svnserve svn.sh</span><br><span class="line">[root@yt-01 LNMP]# echo &quot;^^^^&quot; &gt;&gt; lnmp.sh</span><br><span class="line">[root@yt-01 LNMP]# git add lnmp.sh</span><br><span class="line">[root@yt-01 LNMP]# git commit -m &quot;瞎改&quot;</span><br><span class="line">[master c67bc06] 瞎改</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line"># 此时只是提交到了本地仓库</span><br></pre></td></tr></table></figure>

<h2 id="推送到远程仓库"><a href="#推送到远程仓库" class="headerlink" title="推送到远程仓库"></a>推送到远程仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 LNMP]# git push</span><br><span class="line">Warning: Permanently added the RSA host key for IP address &apos;192.30.253.112&apos; to the list of known hosts.</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 293 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">remote: Resolving deltas: 100% (2/2), completed with 2 local objects.</span><br><span class="line">To git@github.com:zhouqunic/LNMP.git</span><br><span class="line">   027e59a..c67bc06 master -&gt; master</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/21.9-21.12 Redis介绍、安装、持久型、数据类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/21.9-21.12 Redis介绍、安装、持久型、数据类型/" itemprop="url">21.9-21.12 Redis介绍、安装、持久型、数据类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="21-9-redis介绍"><a href="#21-9-redis介绍" class="headerlink" title="21.9 redis介绍"></a>21.9 redis介绍</h1><ul>
<li>Redis和Memcached类似，也属于k-v数据存储 ，但是功能和操作性要比Memcached好很多。</li>
<li>Redis官网 redis.io,当前最新稳定版4.0.9，支持更多value类型，除了和string外，<strong>还支持hash、lists（链表）、sets（集合）和sorted sets（有序集合）</strong></li>
<li>redis使用了两种文件格式：全量数据(RDB)和增量请求(aof)。<ul>
<li><strong>全量数据格式</strong>是把内存中的数据写入磁盘，便于下次读取文件进行加载。</li>
<li><strong>增量请求文件</strong>则是把内存中的数据序列化为操作请求，用于读取文件进行replay得到数据，这种类似于mysql binlog。</li>
</ul>
</li>
<li>为了节省资源，当我们手动保存一次全量数据，就可以删除当前的所有增量数据了，有些增量数据其实早就过期了，也可定期利用脚本做一些优化 。</li>
<li>redis的存储分为<strong>内存存储、磁盘存储和log文件</strong>三部分</li>
</ul>
<h1 id="21-10-redis安装"><a href="#21-10-redis安装" class="headerlink" title="21.10 redis安装"></a>21.10 redis安装</h1><h2 id="1-下载"><a href="#1-下载" class="headerlink" title="1 下载"></a>1 下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">官网地址 redis.io</span><br><span class="line">[root@yt-01 ~]# cd /usr/local/src</span><br><span class="line">[root@yt-01 src]# wget http://download.redis.io/releases/redis-4.0.9.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2 安装"></a>2 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 src]# tar zxvf redis-4.0.9.tar.gz   //解压</span><br><span class="line">[root@yt-01 src]# cd redis-4.0.9                    //进入redis目录</span><br><span class="line">[root@yt-01 redis-4.0.9]# make &amp;&amp; make install    //和其他软件不同，redis安装直接就可以编译</span><br><span class="line">[root@yt-01 redis-4.0.9]# echo $?      //确认编译是否成功</span><br><span class="line">0</span><br><span class="line">[root@yt-01 redis-4.0.9]# redis-      //用tab查看redis的命令，确认是否安装成功</span><br><span class="line">redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server</span><br><span class="line">[root@yt-01 redis-4.0.9]# which redis-cli    //查看redis的启动文件地址</span><br><span class="line">/usr/local/bin/redis-cli</span><br><span class="line">[root@yt-01 redis-4.0.9]# ls    //查看redis安装后的文件</span><br><span class="line">00-RELEASENOTES BUGS CONTRIBUTING COPYING deps INSTALL Makefile MANIFESTO README.md redis.conf runtest runtest-cluster runtest-sentinel sentinel.conf src tests utils</span><br></pre></td></tr></table></figure>

<h2 id="3-配置文件"><a href="#3-配置文件" class="headerlink" title="3 配置文件"></a>3 配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# cp redis.conf /etc/redis.conf</span><br><span class="line">[root@yt-01 redis-4.0.9]# vim /etc/redis.conf    //修改配置文件</span><br><span class="line">……</span><br><span class="line">daemonize yes     #yes表示后台启动；no表示前台启动</span><br><span class="line">pidfile /var/run/redis_6379.pid      #pid存放位置</span><br><span class="line">loglevel notice</span><br><span class="line">#指定日志级别：debug（调试，排错）、verbose（冗长的）、notice、warning</span><br><span class="line">#debug适合排查错误时使用，错误排查完毕后要换到notice，避免产生大量日志浪费系统空间</span><br><span class="line">logfile &quot;/var/log/redis.log&quot; #定义日志存放路径</span><br><span class="line">databases 16</span><br><span class="line">#Redis有库的概念，默认在0库</span><br><span class="line">dir /data/redis #定义rdb、aof文件的存放位置</span><br><span class="line">appendonly yes #开启aof日志，开启后会在dir定义的目录生成appendonly.aof文件</span><br><span class="line">appendfsync everysec #指定记录日志的规则：always（只要有变动就记录）、everysec（每秒记录一次）、no（不记录）</span><br><span class="line"></span><br><span class="line">创建rdb、aof文件的存放文件夹</span><br><span class="line">[root@yt-01 redis-4.0.9]# mkdir /data/redis</span><br><span class="line"></span><br><span class="line">启动redis</span><br><span class="line">[root@yt-01 redis-4.0.9]# redis-server /etc/redis.conf</span><br><span class="line"></span><br><span class="line">查看redis进程（因为虚拟机还运行着gitlab网站服务，所以进程会多几个）</span><br><span class="line">[root@yt-01 redis-4.0.9]# ps aux |grep redis</span><br><span class="line">root 5526 0.0 0.0 4184 16 ? Ss 10:10 0:00 runsv redis</span><br><span class="line">root 5527 0.0 0.0 4328 56 ? S 10:10 0:00 svlogd -tt /var/log/gitlab/redis</span><br><span class="line">gitlab-+ 5528 0.2 0.1 41484 3740 ? Ssl 10:10 0:36 /opt/gitlab/embedded/bin/redis-server 127.0.0.1:0</span><br><span class="line">root 6041 0.0 0.0 4184 0 ? Ss 10:11 0:00 runsv redis-exporter</span><br><span class="line">root 6042 0.0 0.0 4328 36 ? S 10:11 0:00 svlogd -tt /var/log/gitlab/redis-exporter</span><br><span class="line">gitlab-+ 6043 0.0 0.4 53424 7976 ? Ssl 10:11 0:04 /opt/gitlab/embedded/bin/redis_exporter -web.listen-address=localhost:9121 -redis.addr=unix:///var/opt/gitlab/redis/redis.socket</span><br><span class="line">root 36317 0.0 0.1 145260 2184 ? Ssl 13:33 0:00 redis-server 127.0.0.1:6379               //默认监听端口是6379</span><br><span class="line"></span><br><span class="line">查看redis日志</span><br><span class="line">[root@yt-01 redis-4.0.9]# less /var/log/redis.log</span><br><span class="line"># 2条warning，提醒我们有2个内核参数需要调整</span><br><span class="line">……</span><br><span class="line">36317:M 06 Apr 13:33:51.922 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &apos;vm.overcommit_memory = 1&apos; to /etc/sysctl.conf and then reboot or run the command &apos;sysctl vm.overcommit_memory=1&apos; for this to take effect.</span><br><span class="line">36317:M 06 Apr 13:33:51.922 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &apos;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&apos; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span><br><span class="line">36317:M 06 Apr 13:33:51.922 * Ready to accept connections</span><br><span class="line">/var/log/redis.log (END)</span><br><span class="line"></span><br><span class="line">配置内核参数</span><br><span class="line">[root@yt-01 redis-4.0.9]# sysctl vm.overcommit_memory=1</span><br><span class="line">[root@yt-01 redis-4.0.9]# echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line">加入开机启动</span><br><span class="line">[root@yt-01 redis-4.0.9]# vim /etc/rc.local</span><br><span class="line">sysctl vm.overcommit_memory=1</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">[root@yt-01 redis-4.0.9]# redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure>

<h2 id="4-关闭redis服务的方法"><a href="#4-关闭redis服务的方法" class="headerlink" title="4 关闭redis服务的方法"></a>4 关闭redis服务的方法</h2><ul>
<li><p>方法1：<br>查询到PID，kill -9 pid。<br>该方式相当于断电，非正常关闭，一般不用，会造成数据丢失</p>
</li>
<li><p>方法2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# redis-cli shutdown</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="21-11-redis持久化"><a href="#21-11-redis持久化" class="headerlink" title="21.11 redis持久化"></a>21.11 redis持久化</h1><blockquote>
<p>和Memcached服务一样，如果关闭RDB和aof数据就会存储在内存中，当重启服务或者重启机器 存储的数据就会丢失。如果数据很重要，我们就需要做持久化。</p>
</blockquote>
<ul>
<li>Redis提供了两种持久化的方式，分别是<strong>RDB（Redis DataBase）和AOF（Append Only File）</strong><ul>
<li>RDB，简而言之，就是在不同的时间点，将redis存储的数据生成快照并存储到磁盘等介质上。</li>
<li>AOF，则是换了一个角度来实现持久化，那就是将redis执行过的所有写指令记录下来，在下次redis重新启动时，只要把这些写指令从前到后再重复执行一遍，就可以实现数据恢复了。</li>
</ul>
</li>
<li>其实RDB和AOF两种方式也可以同时使用，在这种情况下，如果redis重启的话，则会优先采用AOF方式来进行数据恢复，这是因为AOF方式的数据恢复完整度更高。</li>
<li>如果你没有数据持久化的需求，也完全可以关闭RDB和AOF方式，这样的话，redis将变成一个纯内存数据库，就像memcache一样。</li>
</ul>
<h2 id="1-redis持久化相关的参数"><a href="#1-redis持久化相关的参数" class="headerlink" title="1 redis持久化相关的参数"></a>1 redis持久化相关的参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">save 900 1          //表示每15分钟且至少有1个key改变，就触发一次持久化</span><br><span class="line">save 300 10        //表示每5分钟且至少有10个key改变，就触发一次持久化</span><br><span class="line">save 60 10000    //表示每60秒至少有10000个key改变，就触发一次持久</span><br><span class="line">save &quot; &quot;                //这样可以禁用rdb持久化</span><br><span class="line">appendonly yes   //如果是yes，则开启aof持久化</span><br><span class="line">appendfilename “appendonly.aof”   //指定aof文件名字</span><br><span class="line">appendfsync everysec  //每一秒写入aof文件，并完成磁盘同步。</span><br><span class="line"># 指定fsync()调用模式，有三种</span><br><span class="line"># no(不调用fsync),always(每次写都会调用fsync),everysec(每秒钟调用一次fsync)。</span><br><span class="line"># 第一种最快，第二种数据最安全，但会占用磁盘I/O会差一些，第三种为这种方案最恰当，默认选第三种。</span><br></pre></td></tr></table></figure>

<h2 id="2-开启和关闭持久化"><a href="#2-开启和关闭持久化" class="headerlink" title="2 开启和关闭持久化"></a>2 开启和关闭持久化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">开启</span><br><span class="line">[root@yt-01 ~]# vim /etc/redis.conf</span><br><span class="line">……</span><br><span class="line"># save &quot; &quot;</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">关闭</span><br><span class="line">[root@yt-01 ~]# vim /etc/redis.conf</span><br><span class="line">……</span><br><span class="line">save &quot; &quot;</span><br><span class="line"># save 900 1</span><br><span class="line"># save 300 10</span><br><span class="line"># save 60 10000</span><br><span class="line"></span><br><span class="line">设置完后，重启服务</span><br><span class="line"># redis-cli -p 127.0.0.1 shutdown </span><br><span class="line"># redis-server  /etc/redis.conf</span><br></pre></td></tr></table></figure>

<h1 id="21-12-redis数据类型"><a href="#21-12-redis数据类型" class="headerlink" title="21.12 redis数据类型"></a>21.12 redis数据类型</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string</span><br><span class="line">list</span><br><span class="line">set</span><br><span class="line">sort set</span><br><span class="line">hash</span><br></pre></td></tr></table></figure>

<h2 id="1-Redis数据类型-string"><a href="#1-Redis数据类型-string" class="headerlink" title="1 Redis数据类型-string"></a>1 Redis数据类型-string</h2><p>string为最简单的类型，与Memcached一样的类型，一个key对应一个value，其支持的操作与Memcached的操作类似，它的功能更丰富。设置可以存二进制的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set mykey 123</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get mykey</span><br><span class="line">&quot;123&quot;</span><br><span class="line">127.0.0.1:6379&gt; mset k1 a k2 b k3 c</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">3) &quot;c&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>

<h2 id="2-Redis数据类型-list"><a href="#2-Redis数据类型-list" class="headerlink" title="2 Redis数据类型-list"></a>2 Redis数据类型-list</h2><ul>
<li><p>list是一个链表结构，主要功能是push、pop、获取一个范围的所有值等等。操作中key理解为链表的名字。</p>
</li>
<li><p>使用 list 结构，我们可以轻松地实现最新消息排行等功能（比如新浪微博的 TimeLine ）。list 的另一个应用就是消息队列，可以利用 list 的 push操作，将任务存在 list 中，然后工作线程再用pop操作将任务取出进行执行。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# redis-cli</span><br><span class="line"># 添加一条list数据</span><br><span class="line">127.0.0.1:6379&gt; lpush list1 &quot;yuntai&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush list1 &quot;yuntai1&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; lpush list1 &quot;yuntai2&quot;</span><br><span class="line">(integer) 3</span><br><span class="line"></span><br><span class="line"># 查看指定list的数据</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) &quot;yuntai2&quot;</span><br><span class="line">2) &quot;yuntai1&quot;</span><br><span class="line">3) &quot;yuntai&quot;</span><br><span class="line"></span><br><span class="line"># 取出（pop挤出）一条数据，挤出就没有了</span><br><span class="line">127.0.0.1:6379&gt; lpop list1</span><br><span class="line">&quot;yuntai2&quot;</span><br><span class="line"># 取出数据list 从0到1</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) &quot;yuntai1&quot;</span><br><span class="line">2) &quot;yuntai&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>

<h2 id="3-Redis数据类型-set"><a href="#3-Redis数据类型-set" class="headerlink" title="3 Redis数据类型-set"></a>3 Redis数据类型-set</h2><ul>
<li>set是集合，和我们数学中的集合概念相似，对集合的操作有添加删除元素，有对多个集合求交并差等操作。操作中key理解为集合的名字。比如在微博应用中，可以将一个用户所有的关注人存在一个集合中，将其所有粉丝存在一个集合。因为 Redis 非常人性化的为集合提供了求交集、并集、差集等操作，那么就可以非常方便的实现如共同关注、共同喜好、二度好友等功能，对上面的所有集合操作，你还可以使用不同的命令选择将结果返回给客户端还是存集到一个新的集合中。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# redis-cli</span><br><span class="line"># 添加一条set数据</span><br><span class="line">127.0.0.1:6379&gt; SADD set1 a</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD set1 b</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD set1 c</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD set1 d</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"># 查看set数据</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS set1</span><br><span class="line">1) &quot;d&quot;</span><br><span class="line">2) &quot;c&quot;</span><br><span class="line">3) &quot;a&quot;</span><br><span class="line">4) &quot;b&quot;</span><br><span class="line">127.0.0.1:6379&gt; SREM set1 c</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD set2 a 2 b</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; SINTER set1 set2</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">127.0.0.1:6379&gt; SUNION set1 set2</span><br><span class="line">1) &quot;d&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">3) &quot;2&quot;</span><br><span class="line">4) &quot;b&quot;</span><br><span class="line">127.0.0.1:6379&gt; SDIFF set1 set2</span><br><span class="line">1) &quot;d&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>

<h2 id="4-Redis数据类型-sort-set"><a href="#4-Redis数据类型-sort-set" class="headerlink" title="4 Redis数据类型-sort set"></a>4 Redis数据类型-sort set</h2><ul>
<li>sorted set是有序集合，它比set多了一个权重参数score，使得集合中的元素能够按score进行有序排列，比如一个存储全班同学成绩的Sorted Sets，其集合value可以是同学的学号，而score就可以是其考试得分，这样在数据插入集合的时候，就已经进行了天然的排序。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# redis-cli</span><br><span class="line"># 添加sort set数据</span><br><span class="line">127.0.0.1:6379&gt; ZADD set3 12 abc</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD set3 2 &quot;cde 123&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD set3 24 &quot;123-aaa&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD set3 4 &quot;a123a&quot;</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"># 查看数据set3</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE set3 0 -1</span><br><span class="line">1) &quot;cde 123&quot;</span><br><span class="line">2) &quot;a123a&quot;</span><br><span class="line">3) &quot;abc&quot;</span><br><span class="line">4) &quot;123-aaa&quot;</span><br><span class="line">#数据的value根据score大小排序</span><br><span class="line"></span><br><span class="line"># 倒序查看数据set3</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE set3 0 -1</span><br><span class="line">1) &quot;123-aaa&quot;</span><br><span class="line">2) &quot;abc&quot;</span><br><span class="line">3) &quot;a123a&quot;</span><br><span class="line">4) &quot;cde 123&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>

<h2 id="5-Redis数据类型-hash"><a href="#5-Redis数据类型-hash" class="headerlink" title="5 Redis数据类型- hash"></a>5 Redis数据类型- hash</h2><p>在 Memcached 中，我们经常将一些结构化的信息打包成hashmap，在客户端序列化后存储为一个字符串的值（一般是JSON格式），比如用户的昵称、年龄、性别、积分等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 redis-4.0.9]# redis-cli</span><br><span class="line"># 添加一条hash数据hash1 k值为name，v值为yuntai</span><br><span class="line">127.0.0.1:6379&gt; hset hash1 name yuntai</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"># 查询数据hash1 k值为name的v值</span><br><span class="line">127.0.0.1:6379&gt; hget hash1 name</span><br><span class="line">&quot;yuntai&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hset hash1 age 27</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hget hash1 age</span><br><span class="line">&quot;27&quot;</span><br><span class="line"></span><br><span class="line"># 查询hash1的所有值</span><br><span class="line">127.0.0.1:6379&gt; hgetall hash1</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">2) &quot;yuntai&quot;</span><br><span class="line">3) &quot;age&quot;</span><br><span class="line">4) &quot;27&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/22.9-22.12 git分支管理、远程分支管理、标签管理、git别名/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/22.9-22.12 git分支管理、远程分支管理、标签管理、git别名/" itemprop="url">22.9-22.12 git分支管理、远程分支管理、标签管理、git别名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>二十二周三次课（10月25日）<br>[toc]</p>
<h1 id="22-9-分支管理"><a href="#22-9-分支管理" class="headerlink" title="22.9 分支管理"></a>22.9 分支管理</h1><h2 id="1-查看分支"><a href="#1-查看分支" class="headerlink" title="1 查看分支"></a>1 查看分支</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 LNMP]# cd /data/gitroot</span><br><span class="line">[root@yt-01 gitroot]# git branch</span><br><span class="line">* master</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt</span><br></pre></td></tr></table></figure>

<h2 id="2-创建分支"><a href="#2-创建分支" class="headerlink" title="2 创建分支"></a>2 创建分支</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gitroot]# git branch yuntai</span><br><span class="line">[root@yt-01 gitroot]# git branch</span><br><span class="line">* master</span><br><span class="line">  yuntai</span><br></pre></td></tr></table></figure>

<h2 id="3-分支管理"><a href="#3-分支管理" class="headerlink" title="3 分支管理"></a>3 分支管理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 切换到分支</span><br><span class="line">[root@yt-01 gitroot]# git checkout yuntai</span><br><span class="line">切换到分支 &apos;yuntai&apos;</span><br><span class="line">[root@yt-01 gitroot]# git branch    //*号在yuntai分支前，表示目前的分支</span><br><span class="line">  master</span><br><span class="line">* yuntai</span><br><span class="line">[root@yt-01 gitroot]# ls    //2个分支下文件相同</span><br><span class="line">1.txt</span><br><span class="line"></span><br><span class="line"># 新分支下创建新文件</span><br><span class="line">[root@yt-01 gitroot]# vim 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git add 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;jjjjjj&quot;</span><br><span class="line">[yuntai 98bf627] jjjjjj</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 2.txt</span><br><span class="line">[root@yt-01 gitroot]# cat 2.txt</span><br><span class="line">1234hghklal</span><br><span class="line"></span><br><span class="line"># 切换回master分支</span><br><span class="line">[root@yt-01 gitroot]# git checkout master</span><br><span class="line">切换到分支 &apos;master&apos;</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt</span><br><span class="line">由此可见，在不同的分支可看到的文件的内容是不同的，在所有分支都能看到master分支的文件。</span><br></pre></td></tr></table></figure>

<h2 id="4-分支合并与冲突"><a href="#4-分支合并与冲突" class="headerlink" title="4 分支合并与冲突"></a>4 分支合并与冲突</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># 分支合并</span><br><span class="line">[root@yt-01 gitroot]# git merge yuntai   //把yuntai分支合并到了master分支</span><br><span class="line">更新 5acf95f..98bf627</span><br><span class="line">Fast-forward</span><br><span class="line"> 2.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 2.txt</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt 2.txt</span><br><span class="line"></span><br><span class="line"># 分支合并的冲突问题</span><br><span class="line">[root@yt-01 gitroot]# vim 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git add 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;sdjjjjjj&quot;</span><br><span class="line">[master cf73e6e] sdjjjjjj</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">[root@yt-01 gitroot]# git branch</span><br><span class="line">* master</span><br><span class="line">  yuntai</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git checkout yuntai</span><br><span class="line">切换到分支 &apos;yuntai&apos;</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# vim 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git add 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;dddjjjj&quot;</span><br><span class="line">[yuntai ba7c380] dddjjjj</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">[root@yt-01 gitroot]# git merge master</span><br><span class="line">自动合并 2.txt</span><br><span class="line">冲突（内容）：合并冲突于 2.txt</span><br><span class="line">自动合并失败，修正冲突然后提交修正的结果。</span><br><span class="line"></span><br><span class="line"># 发生冲突！！！需要先修复冲突后才能合并</span><br><span class="line"># 解决冲突</span><br><span class="line"></span><br><span class="line"># 使用git diff或cat查看冲突在哪：</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git diff</span><br><span class="line">diff --cc 2.txt</span><br><span class="line">index 4311c21,4c236d2..0000000</span><br><span class="line">--- a/2.txt</span><br><span class="line">+++ b/2.txt</span><br><span class="line">@@@ -1,1 -1,1 +1,5 @@@</span><br><span class="line">++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"> +1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal</span><br><span class="line">++=======</span><br><span class="line">+ doaiodwdndian</span><br><span class="line">++&gt;&gt;&gt;&gt;&gt;&gt;&gt; master</span><br><span class="line"></span><br><span class="line"># cat和vim命令中也会提醒冲突的地方</span><br><span class="line">[root@yt-01 gitroot]# cat 2.txt</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal1234hghklal</span><br><span class="line">=======</span><br><span class="line">doaiodwdndian</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; master</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git checkout master   //分支冲突的话，必须先解决冲突才能切换分支，所以分支冲突很麻烦，一定要注意</span><br><span class="line">2.txt: needs merge</span><br><span class="line">error: 您需要先解决当前索引的冲突</span><br><span class="line">[root@yt-01 gitroot]# git branch</span><br><span class="line">  master</span><br><span class="line">* yuntai</span><br><span class="line">[root@yt-01 gitroot]# vim 2.txt</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git merge master          //没有提交修改，所以报错</span><br><span class="line">error: &apos;merge&apos; is not possible because you have unmerged files.</span><br><span class="line">提示：请先在工作区改正文件，然后酌情使用</span><br><span class="line">提示：&apos;git add/rm &lt;file&gt;&apos; 标记解决方案，</span><br><span class="line">提示：或使用 &apos;git commit -a&apos;。</span><br><span class="line">fatal: Exiting because of an unresolved conflict.</span><br><span class="line"></span><br><span class="line">修改后提交</span><br><span class="line">[root@yt-01 gitroot]# git add 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git commit -m &quot;修改冲突内容&quot;</span><br><span class="line">[yuntai 0ac22aa] 修改冲突内容</span><br><span class="line"></span><br><span class="line">合并分支</span><br><span class="line">[root@yt-01 gitroot]# git merge master</span><br><span class="line">Already up-to-date.</span><br><span class="line">[root@yt-01 gitroot]# ls</span><br><span class="line">1.txt 2.txt</span><br><span class="line">[root@yt-01 gitroot]# git checkout master</span><br><span class="line">切换到分支 &apos;master&apos;</span><br><span class="line"></span><br><span class="line">解决冲突的办法是更改目标分支下冲突文件和源分支中内容一致，然后在提交、合并。</span><br><span class="line">原则：只能将新分支合并到旧的分支，即merge后面跟内容最新的分支。</span><br></pre></td></tr></table></figure>

<ul>
<li>如果master分支和yuntai分支都对2.txt进行了编辑，当合并时会提示冲突，需要先解决冲突才可以继续合并。</li>
<li>解决冲突的方法是在master分支下，编辑2.txt，改为aming分支里面2.txt的内容。 然后提交2.txt，再合并yuntai分支。</li>
<li>但是这样有一个问题，万一master分支更改的内容是我们想要的呢？ 可以编辑2.txt内容，改为想要的，然后提交。切换到yuntai<br>分支，然后合并master分支到yuntai分支即可（倒着合并）。合并分支有一个原则，那就是要把最新的分支合并到旧的分支。也就是说merge后面跟的分支名字一定是最新的分支。</li>
</ul>
<h2 id="5-删除分支"><a href="#5-删除分支" class="headerlink" title="5 删除分支"></a>5 删除分支</h2><p>如果我们确定不想要某个分支，我们可以删除分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gitroot]# git branch -d yuntai   //如果分支没有合并，删除之前会提示，那就不合并，强制删除</span><br><span class="line">error: 分支 &apos;yuntai&apos; 没有完全合并。</span><br><span class="line">如果您确认要删除它，执行 &apos;git branch -D yuntai&apos;。</span><br><span class="line"></span><br><span class="line">[root@yt-01 gitroot]# git branch -D yuntai   //强制删除</span><br><span class="line">已删除分支 yuntai（曾为 0ac22aa）。</span><br><span class="line">[root@yt-01 gitroot]# git branch</span><br><span class="line">* master</span><br></pre></td></tr></table></figure>

<h2 id="6-分支使用原则"><a href="#6-分支使用原则" class="headerlink" title="6 分支使用原则"></a>6 分支使用原则</h2><ul>
<li>master分支是非常重要的，线上发布代码用这个分支，平时开发代码不要在该分支操作；</li>
<li>创建dev分支，专门用作开发，只有到发布到线上之前再把dev合并到master上</li>
<li>开发人员应该在dev分支的基础上再分支成个人分支，自己的分支（在自己的pc上）里面开发代码，然后合并到dev分支。 </li>
</ul>
<ul>
<li>在dev分支合并bob分支的命令：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git checkout dev</span><br><span class="line"># git merge bob</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="22-10-远程分支管理"><a href="#22-10-远程分支管理" class="headerlink" title="22.10 远程分支管理"></a>22.10 远程分支管理</h1><h2 id="1-我们现在远程创建2个分支"><a href="#1-我们现在远程创建2个分支" class="headerlink" title="1 我们现在远程创建2个分支"></a>1 我们现在远程创建2个分支</h2><h2 id="2-在远程仓库克隆到本地"><a href="#2-在远程仓库克隆到本地" class="headerlink" title="2 在远程仓库克隆到本地"></a>2 在远程仓库克隆到本地</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01~]# cd /data/</span><br><span class="line">[root@yt-01 data]# git clone git@github.com:zhouqunic/gittest.git</span><br><span class="line">正克隆到 &apos;gittest&apos;...</span><br><span class="line">remote: Counting objects: 6, done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 6 (delta 0), reused 6 (delta 0), pack-reused 0</span><br><span class="line">接收对象中: 100% (6/6), done.</span><br><span class="line">[root@yt-01 data]# ls</span><br><span class="line">gitroot gittest mysql svnroot wwwroot</span><br><span class="line"></span><br><span class="line">[root@yt-01 data]# cd gittest/</span><br><span class="line">[root@yt-01 gittest]# ls</span><br><span class="line">123.txt README.md</span><br><span class="line">[root@yt-01 gittest]#</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git branch</span><br><span class="line">* master</span><br><span class="line"># 克隆远程的时候只能把master克隆下来</span><br></pre></td></tr></table></figure>

<h2 id="查看远程分支，并克隆下来"><a href="#查看远程分支，并克隆下来" class="headerlink" title="查看远程分支，并克隆下来"></a>查看远程分支，并克隆下来</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gittest]# git ls-remote origin   //查看远程所有分支</span><br><span class="line">6007c36bb6151394b59c936deb0f67456fd8c639	HEAD</span><br><span class="line">6007c36bb6151394b59c936deb0f67456fd8c639	refs/heads/dev</span><br><span class="line">6007c36bb6151394b59c936deb0f67456fd8c639	refs/heads/master</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git checkout -b dev origin/dev   //克隆远程分支</span><br><span class="line">分支 dev 设置为跟踪来自 origin 的远程分支 dev。</span><br><span class="line">切换到一个新分支 &apos;dev&apos;</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git branch   //查看分支</span><br><span class="line">* dev</span><br><span class="line">  master</span><br><span class="line">[root@yt-01 gittest]# ls</span><br><span class="line">123.txt README.md</span><br><span class="line">[root@yt-01 gittest]# vim 4.txt</span><br><span class="line">[root@yt-01 gittest]# vim 4.txt</span><br><span class="line">[root@yt-01 gittest]# git add 4.txt</span><br><span class="line">[root@yt-01 gittest]# git commit -m &quot;add 4.txt&quot;</span><br><span class="line">[dev 4585f09] add 4.txt</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 4.txt</span><br><span class="line">[root@yt-01 gittest]# git push     //git push会把所有的分支变更推送到远程分支上</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 302 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line">   6007c36..4585f09 dev -&gt; dev</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git push origin dev         //只推送选定的分支</span><br><span class="line">Everything up-to-date</span><br></pre></td></tr></table></figure>

<h2 id="本地分支比远程分支还多"><a href="#本地分支比远程分支还多" class="headerlink" title="本地分支比远程分支还多"></a>本地分支比远程分支还多</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@yt-01 gittest]# git branch dev2     //新建本地分支dev2</span><br><span class="line">[root@yt-01 gittest]# git branch</span><br><span class="line">* dev</span><br><span class="line">  dev2</span><br><span class="line">  master</span><br><span class="line">[root@yt-01 gittest]# git checkout dev2   //切换到新分支</span><br><span class="line">切换到分支 &apos;dev2&apos;</span><br><span class="line">[root@yt-01 gittest]# ls</span><br><span class="line">123.txt 4.txt README.md</span><br><span class="line">[root@yt-01 gittest]# echo -e &quot;5555&quot; &gt; 5.txt   //新增新文件，并推送到本地</span><br><span class="line">[root@yt-01 gittest]# ls</span><br><span class="line">123.txt 4.txt 5.txt README.md</span><br><span class="line">[root@yt-01 gittest]# git add 5.txt</span><br><span class="line">[root@yt-01 gittest]# git commit -m &quot;add 5.txt&quot;</span><br><span class="line">[dev2 13cb704] add 5.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 5.txt</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git push    //推送到远程，结果出现报错，提示用git push --set-upstream origin dev2命令推送</span><br><span class="line">fatal: 当前分支 dev2 没有对应的上游分支。</span><br><span class="line">为推送当前分支并建立与远程上游的跟踪，使用</span><br><span class="line">    git push --set-upstream origin dev2</span><br><span class="line">[root@yt-01 gittest]# git push --set-upstream origin dev2   //从本地推送远程没有的分支</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 324 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line"> * [new branch] dev2 -&gt; dev2</span><br><span class="line">分支 dev2 设置为跟踪来自 origin 的远程分支 dev2。</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git ls-remote origin      //查看远程分支，新分支dev2已经推送成功</span><br><span class="line">6007c36bb6151394b59c936deb0f67456fd8c639	HEAD</span><br><span class="line">4585f09ea5741cd9030c781a5e0a75629683fcef	refs/heads/dev</span><br><span class="line">13cb704ff422999a9d0ec83f67f6e03f61dfaa94	refs/heads/dev2</span><br><span class="line">6007c36bb6151394b59c936deb0f67456fd8c639	refs/heads/master</span><br></pre></td></tr></table></figure>

<ul>
<li>本地新建的分支如果不推送到远程，对其他人就是不可见的 </li>
<li>查看远程分支 git ls-remote origin，可以看到所有分支</li>
<li>对于git push分支分两种情况</li>
<li>当本地分支和远程分支一致时,git push会把所有本地分支的变更一同推送到远程，如果想只推送一个分支，使用git push origin branch-name</li>
<li>当本地分支比远程分支多,默认git push 只推送本地和远程一致的分支，想要把多出来的本地分支推送到远程时，使用git push origin branch-name 如果推送失败，先用git         pull抓取远程的新提交.</li>
<li>git clone的时候默认只把master分支克隆下来，如果想把所有分支都克隆下来，需要手动创建，在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称要一致</li>
</ul>
<h1 id="22-11-标签管理"><a href="#22-11-标签管理" class="headerlink" title="22.11 标签管理"></a>22.11 标签管理</h1><ul>
<li>标签类似于快照功能，可以给版本库打一个标签，记录某个时刻库的状态。也可以随时恢复到该状态。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gittest]# git checkout master    //先切到master分支上</span><br><span class="line">[root@yt-01 gittest]# git tag v1.0     //给master打一个标签v1.0</span><br><span class="line">[root@yt-01 gittest]# git show v1.0     //查看标签信息</span><br><span class="line">commit 6007c36bb6151394b59c936deb0f67456fd8c639</span><br><span class="line">Author: yuntai &lt;zhouqunic@163.com&gt;</span><br><span class="line">Date: Tue Apr 3 16:01:02 2018 +0800</span><br><span class="line">    新建123.txt文件</span><br><span class="line">diff --git a/123.txt b/123.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..f3bed95</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/123.txt</span><br><span class="line">@@ -0,0 +1,3 @@</span><br><span class="line">+123 123 123</span><br><span class="line">+123 123</span><br><span class="line">+123</span><br><span class="line"></span><br><span class="line"># tag是针对commit来打标签的，所以可以针对历史的commit来打tag</span><br><span class="line"># git tag 可以查看所有的标签</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git log --pretty=oneline --abbrev-commit //先查看历史的commit</span><br><span class="line">6007c36 新建123.txt文件</span><br><span class="line">f7045bf 创建README.md</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git tag v0.8  f7045bf //针对历史commit打标签</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git tag -d v0.8 //删除标签</span><br><span class="line">已删除 tag &apos;v0.8&apos;（曾为 f7045bf）</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git tag -a v0.8 -m &quot;tag just v1.1 and so on&quot;  f7045bf    //可以对标签进行描述</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git push origin v1.0 //推送指定标签到远程</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git push --tag origin   //推送所有标签</span><br><span class="line">Counting objects: 1, done.</span><br><span class="line">Writing objects: 100% (1/1), 166 bytes | 0 bytes/s, done.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:zhouqunic/gittest.git</span><br><span class="line"> * [new tag] v0.8 -&gt; v0.8</span><br><span class="line"></span><br><span class="line"> 如果本地删除了一个标签，远程也想要删除需要这样操作：</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git tag v1.0 -d                            //删除本地标签</span><br><span class="line">[root@yt-01 gittest]# git push origin :refs/tags/v1.0     //删除远程标签</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>实际上，tag和分支十分类似，只是概念上的不同。</p>
<h1 id="22-12-git别名"><a href="#22-12-git别名" class="headerlink" title="22.12 git别名"></a>22.12 git别名</h1><h2 id="git设置别名"><a href="#git设置别名" class="headerlink" title="git设置别名"></a>git设置别名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 把ci设置为commit命令的别名</span><br><span class="line">[root@yt-01 gittest]# git config --global alias.ci commit</span><br><span class="line"></span><br><span class="line"># 把co设置为checkout命令的别名</span><br><span class="line">[root@yt-01 gittest]# git config --global alias.co checkout</span><br><span class="line"></span><br><span class="line"># 设置号的别名会保存在文件/root/.gitconfig中，所以可以通过编辑该文件来设置别名</span><br><span class="line">[root@yt-01 gittest]# cat /root/.gitconfig</span><br><span class="line">[user]</span><br><span class="line"> email = zhouqunic@163.com</span><br><span class="line"> name = yuntai</span><br><span class="line">[push]</span><br><span class="line"> default = simple</span><br><span class="line">[alias]</span><br><span class="line"> ci = commit</span><br><span class="line"> co = checkout</span><br><span class="line"></span><br><span class="line"># 查看git别名使用命令</span><br><span class="line">[root@yt-01 gittest]# git config --list |grep alias</span><br><span class="line">alias.ci=commit</span><br><span class="line">alias.co=checkout</span><br></pre></td></tr></table></figure>

<h2 id="查询log小技巧"><a href="#查询log小技巧" class="headerlink" title="查询log小技巧"></a>查询log小技巧</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gittest]# git config --global alias.lg &quot;log --color --graph --pretty=format:&apos;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&apos; --abbrev-commit&quot;     //把git lg彩色排列的历史记录</span><br><span class="line"></span><br><span class="line">[root@yt-01 gittest]# git lg</span><br><span class="line">* 6007c36 - (HEAD, tag: v1.0, origin/master, origin/HEAD, master) 新建123.txt文件 (2 小时之前) &lt;yuntai&gt;</span><br><span class="line">* f7045bf - (tag: v0.8) 创建README.md (3 小时之前) &lt;yuntai&gt;</span><br></pre></td></tr></table></figure>

<h2 id="取消别名"><a href="#取消别名" class="headerlink" title="取消别名"></a>取消别名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@yt-01 gittest]# git config --global --unset alias.co //取消co的别名</span><br><span class="line">[root@yt-01 gittest]# vim vim /root/.gitconfig  //或者直接去配置文件里面删除alias的配置</span><br><span class="line">[user]</span><br><span class="line"> email = zhouqunic@163.com</span><br><span class="line"> name = yuntai</span><br><span class="line">[push]</span><br><span class="line"> default = simple</span><br><span class="line">[alias]</span><br><span class="line"> ci = commit</span><br><span class="line"> lg = log --color --graph --pretty=format:&apos;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&apos; --abbrev-commit</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux入门笔记/7.1 - 7.5 RPM和YUM工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhouqun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Joking的Linux世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux入门笔记/7.1 - 7.5 RPM和YUM工具/" itemprop="url">7.1 - 7.5 RPM和YUM工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T12:49:11+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux入门笔记/" itemprop="url" rel="index">
                    <span itemprop="name">linux入门笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="7-1-安装软件包的三种方法"><a href="#7-1-安装软件包的三种方法" class="headerlink" title="7.1 安装软件包的三种方法"></a>7.1 安装软件包的三种方法</h1><h2 id="三种方法"><a href="#三种方法" class="headerlink" title="三种方法"></a>三种方法</h2><ol>
<li>rpm工具</li>
<li>yum工具</li>
<li>源码包</li>
</ol>
<h1 id="7-2-rpm包介绍"><a href="#7-2-rpm包介绍" class="headerlink" title="7.2 rpm包介绍"></a>7.2 rpm包介绍</h1><p>安装或卸载rpm包，如果该包有依赖则要先安装或卸载其依赖包。</p>
<ul>
<li><p>设置光驱并挂载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/cdrom /mnt/      把光驱挂载到mnt目录下</span><br><span class="line">其中，package目录下面都是rpm包，64位系统是可以安装32位的rpm包的</span><br><span class="line"></span><br><span class="line">rpm包名      lynx-2.8.5-23.i386.rpm</span><br><span class="line">rpm包格式    包名、版本号、发布版本号、平台</span><br></pre></td></tr></table></figure>
</li>
<li><p>rpm常用参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-i, --install                    安装</span><br><span class="line">-v, --verbose                    信息可视化</span><br><span class="line">-h, --hash                        人性化显示</span><br><span class="line">-e, --erase                      卸载</span><br><span class="line">-U, --upgrade=&lt;packagefile&gt;+      升级</span><br><span class="line">--replacepkge                    无论软件包是否已被安装，都强行安装软件包</span><br><span class="line">--test                            安装测试，并不实际安装</span><br><span class="line">--nodeps                          忽略软件包的依赖关系强行安装</span><br><span class="line">--force                          忽略软件包及文件的冲突</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="7-3-rpm工具用法"><a href="#7-3-rpm工具用法" class="headerlink" title="7.3 rpm工具用法"></a>7.3 rpm工具用法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh rpm包文件    安装</span><br><span class="line">rpm -Uvh rpm包文件    升级</span><br><span class="line">rpm -e  包名          卸载</span><br><span class="line">rpm -qa              查询安装的包</span><br><span class="line">rpm -q 包名          查询指定包是否安装</span><br><span class="line">rpm -qi 包名          查询指定包信息</span><br><span class="line">rpm -ql 包名          列出包安装的文件</span><br><span class="line">rpm -qf 文件绝对路径  查看一个文件是由哪个包安装的</span><br></pre></td></tr></table></figure>

<h1 id="7-4-yum工具用法"><a href="#7-4-yum工具用法" class="headerlink" title="7.4 yum工具用法"></a>7.4 yum工具用法</h1><p>用yum工具安装包，不需要先安装其依赖包。</p>
<h2 id="1-yum-红帽子公司开发的专门管理rpm包的工具"><a href="#1-yum-红帽子公司开发的专门管理rpm包的工具" class="headerlink" title="1. yum 红帽子公司开发的专门管理rpm包的工具"></a>1. yum 红帽子公司开发的专门管理rpm包的工具</h2><ol>
<li>可以自动解决rpm安装时候产生的依赖关系</li>
<li>可以自动的在指定的源（网址，rpm包的集合库），下载指定的包</li>
</ol>
<h2 id="2-yum用法"><a href="#2-yum用法" class="headerlink" title="2. yum用法"></a>2. yum用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yum list                  列出可用rpm包</span><br><span class="line">ls /etc/yum.repos.d/      所有yum配置文件</span><br><span class="line">CentOS-Base.repo（主配置文件）  CentOS-CR.repo  CentOS-Debuginfo.repo</span><br><span class="line">CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Sources.repo</span><br><span class="line">CentOS-Vault.repo  epel.repo  epel-testing.repo</span><br><span class="line"></span><br><span class="line">yum search vim            搜索包</span><br><span class="line">yum list | grep &apos;vim&apos;      包名含有vim的包</span><br><span class="line">yum install [-y] 包名      直接安装</span><br><span class="line">yum grouplist              列出已经安装过和可安装的套件，因为是中文的，</span><br><span class="line">必须换成英文才能使用，套件相当于一堆包的集合</span><br><span class="line">yum groupinstall  [-y]    安装套件</span><br><span class="line">yum remove [-y]            卸载一个rpm包，一般不加y</span><br><span class="line">yum groupremove            卸载套件</span><br><span class="line">yum update [-y]            升级一个rpm包，一般不用，升级包会牵涉到很多支持包的支持问题</span><br><span class="line">yum provides  “/*/vim”      搜索vim命令是由哪个包安装的</span><br><span class="line">yum provides  &quot;/*/命令&quot;    搜索一个命令是由哪个包安装的</span><br></pre></td></tr></table></figure>

<h1 id="7-5-yum搭建本地仓库"><a href="#7-5-yum搭建本地仓库" class="headerlink" title="7.5 yum搭建本地仓库"></a>7.5 yum搭建本地仓库</h1><ul>
<li>实操全过程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">实际操作全过程</span><br><span class="line"></span><br><span class="line">[root@localhos]# mount /dev/cdrom  /mnt          **挂载CD安装光盘到mnt**</span><br><span class="line">[root@localhost etc]# cd /etc/yum.repos.d/        **进入目录**</span><br><span class="line">[root@localhost yum.repos.d]# ls                          **查看目录**</span><br><span class="line">CentOS-Base.repo  CentOS-CR.repo  CentOS-Debuginfo.repo  CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Sources.repo  CentOS-Vault.repo</span><br><span class="line">[root@localhost yum.repos.d]# cp -r yum.repos.d/  yum.repos.d.bak        **备份yum配置文件**</span><br><span class="line">cp: 无法获取&quot;yum.repos.d/&quot; 的文件状态(stat): 没有那个文件或目录</span><br><span class="line">[root@localhost yum.repos.d]# cd ..</span><br><span class="line">[root@localhost etc]# cp -r yum.repos.d/  yum.repos.d.bak        **备份yum配置文件**</span><br><span class="line">[root@localhost etc]# cd /etc/yum.repos.d/</span><br><span class="line">[root@localhost yum.repos.d]# ls</span><br><span class="line">CentOS-Base.repo  CentOS-CR.repo  CentOS-Debuginfo.repo  CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Sources.repo  CentOS-Vault.repo</span><br><span class="line">[root@localhost yum.repos.d]# rm -rf CentOS-Base.repo          **删除配置文件**</span><br><span class="line">[root@localhost yum.repos.d]# yum list          **查看yum仓库**</span><br><span class="line">xmlrpc3-common-devel.noarch                                                3.0-4.15.el6                                          base</span><br><span class="line">xmlrpc3-javadoc.noarch                                                    3.0-4.15.el6                                          base</span><br><span class="line">xmlrpc3-server.noarch                                                      3.0-4.15.el6                                          base</span><br><span class="line">xmlrpc3-server-devel.noarch                                                3.0-4.15.el6                                          base</span><br><span class="line">xmlsec1.i686                                                              1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-devel.i686                                                        1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-gcrypt.i686                                                        1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-gcrypt-devel.i686                                                  1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-gnutls.i686                                                        1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-gnutls-devel.i686                                                  1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-nss.i686                                                          1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-nss-devel.i686                                                    1.2.20-4.el6                                          base</span><br><span class="line">xmlsec1-openssl.i686                                                      1.2.20-4.el6                                          base</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost yum.repos.d]# vim CentOS-Media.repo        **新建并编辑yum仓库配置文件**</span><br><span class="line"></span><br><span class="line">entOS-Media.repo</span><br><span class="line">#</span><br><span class="line">#  This repo can be used with mounted DVD media, verify the mount point for</span><br><span class="line">#  CentOS-7.  You can use this repo and yum to install items directly off the</span><br><span class="line">#  DVD ISO that we release.</span><br><span class="line">#</span><br><span class="line"># To use this repo, put in your DVD and use it with the other repos too:</span><br><span class="line">#  yum --enablerepo=c7-media [command]</span><br><span class="line">#  </span><br><span class="line"># or for ONLY the media repo, do this:</span><br><span class="line">#</span><br><span class="line">#  yum --disablerepo=\* --enablerepo=c7-media [command]</span><br><span class="line"></span><br><span class="line">[c7-media] </span><br><span class="line">name=CentOS-$releasever - Media</span><br><span class="line">baseurl=file:///media/CentOS/</span><br><span class="line">        file:///media/cdrom/</span><br><span class="line">        file:///media/cdrecorder/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">改成</span><br><span class="line"></span><br><span class="line">[local_cdrom]        **路径名字**</span><br><span class="line">name=cd          **名字**</span><br><span class="line">baseurl=file:///mnt        **绝对路径地方**</span><br><span class="line">gpgcheck=0          **不检测**</span><br><span class="line">enabled=1          **生效**</span><br><span class="line">#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7  **不要**                                                                                                                                                          </span><br><span class="line">~                                                                                                                                                                    </span><br><span class="line">~                                                                                                                                                                    </span><br><span class="line">~                                                                                                                                                                    </span><br><span class="line">~                                                                                                                                                                    </span><br><span class="line">~                                                                                                                                                                    </span><br><span class="line">-- 插入 --                                      </span><br><span class="line">：wq 保存并退出</span><br><span class="line"></span><br><span class="line"># yum clean all  **清除缓存**</span><br><span class="line"></span><br><span class="line"># yum list    **再次查看yum仓库，已经成为本地yum仓库**</span><br><span class="line">perl-SNMP_Session.noarch                                                          1.13-5.el7                                                            local_cdrom</span><br><span class="line">perl-Socket6.x86_64                                                                0.23-15.el7                                                            local_cdrom</span><br><span class="line">perl-String-ShellQuote.noarch                                                      1.04-10.el7                                                            local_cdrom</span><br><span class="line">perl-Sub-Install.noarch                                                            0.926-6.el7                                                            local_cdrom</span><br><span class="line">perl-Sys-CPU.x86_64                                                                0.54-4.el7                                                            local_cdrom</span><br><span class="line">perl-Sys-Guestfs.x86_64                                                            1:1.32.7-3.el7.centos                                                  local_cdrom</span><br><span class="line">perl-Sys-MemInfo.x86_64                                                            0.91-7.el7                                                            local_cdrom</span><br><span class="line">perl-Sys-Syslog.x86_64                                                            0.33-3.el7                                                            local_cdrom</span><br><span class="line">perl-Sys-Virt.x86_64                                                              2.0.0-1.el7                                                            local_cdrom</span><br><span class="line">perl-Term-UI.noarch                                                                0.36-2.el7                                                            local_cdrom</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><h2 id="1-yum保留已经安装过的包"><a href="#1-yum保留已经安装过的包" class="headerlink" title="1. yum保留已经安装过的包"></a>1. yum保留已经安装过的包</h2><p>可以设置使yum保留已经下载的rpm包，供以后升级或重新安装时使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">修改/etc/yum.conf即可：</span><br><span class="line">[main]</span><br><span class="line">cachedir=/home/soft1/yumcache</span><br><span class="line">keepcache=1</span><br><span class="line">debuglevel=2</span><br><span class="line">chchedir是放置下载的包的地方，可以修改为自己想放置的位置。</span><br><span class="line">keepcache为1时表示保存已经下载的rpm包。</span><br></pre></td></tr></table></figure>

<h2 id="2-搭建局域网yum源"><a href="#2-搭建局域网yum源" class="headerlink" title="2. 搭建局域网yum源"></a>2. 搭建局域网yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1、搭建Apache服务器或ftp服务器</span><br><span class="line">yum安装或二进制包安装</span><br><span class="line"></span><br><span class="line">2、准备RPM包把CentOS的DVD1和DVD2.iso都下载下来，把DVD1.iso里的所有内容解压出来，</span><br><span class="line">放到/var/www/html/centos-6目录下，然后把DVD2.iso解压出来的Packages目录下的rpm包</span><br><span class="line">复制到/var/html/centos-6/Packages目录下，这样/var/html/centos-6/Packages里面就有了6000多个rpm包。</span><br><span class="line"></span><br><span class="line">3、创建yum仓库</span><br><span class="line">准备createrepo：yum -y install createrepo</span><br><span class="line">创建repository：createrepo /var/www/html/centos-6/</span><br><span class="line">创建完成之后，会在/var/www/html/centos-6/repodata下生成一些文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4、使用软件源</span><br><span class="line"></span><br><span class="line">在其他centos机器上试试软件源能不能用。</span><br><span class="line"></span><br><span class="line">首先修改机器上软件源配置文件：</span><br><span class="line"></span><br><span class="line"># cd /etc/yum.repos.d/</span><br><span class="line"># mkdir bk</span><br><span class="line"># mv *.repo bk/</span><br><span class="line"># cp bk/CentOS-Base.repo ./</span><br><span class="line"># vi CentOS-Base.repo</span><br><span class="line"></span><br><span class="line">CentOS-Base.repo文件修改之后如下：</span><br><span class="line"></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base</span><br><span class="line">baseurl=http://*.*.*.*/centos-6/</span><br><span class="line">gpgcheck=1(改成0下面那行就不用设置了)</span><br><span class="line">gpgkey=http:///*.*.*.*/centos-6/RPM-GPG-KEY-CentOS-6</span><br><span class="line">enabled=1</span><br><span class="line">#released updates </span><br><span class="line">#[updates]</span><br><span class="line">#name=CentOS-$releasever - Updates</span><br><span class="line">#baseurl=http:///*.*.*.*/centos-6/</span><br><span class="line">#gpgcheck=1</span><br><span class="line">#gpgkey=http:///*.*.*.*/centos-6/RPM-GPG-KEY-CentOS-6</span><br><span class="line">#enabled = 1</span><br><span class="line"></span><br><span class="line">保存之后，就可以使用局域网的软件源了：</span><br><span class="line"></span><br><span class="line"># yum update</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zhouqun</p>
              <p class="site-description motion-element" itemprop="description">个人Linux学习和工作记录的小地方</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">109</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhouqun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
